(function(){'use strict';var kivi={DEBUG:!1,ENABLE_COMPONENT_RECYCLING:!1,ENABLE_DISPATCHER_LOGGING:!1};kivi.DEBUG&&(console.info("kivi debug mode: on"),console.info("kivi component recycling: ",kivi.ENABLE_COMPONENT_RECYCLING?"on":"off"));kivi.CDescriptorFlags={SVG:1,WRAPPER:2,RECYCLE_ENABLED:kivi.ENABLE_COMPONENT_RECYCLING?4:0};kivi.InvalidatorSubscriptionFlags={COMPONENT:1,TRANSIENT:2};kivi.InvalidatorSubscription=function(a,b,c){this.flags=a;this.invalidator=b;this.subscriber=c;kivi.DEBUG&&(this._isCanceled=!1)};kivi.InvalidatorSubscription.prototype.cancel=function(){if(kivi.DEBUG){if(this._isCanceled)throw Error("Failed to cancel InvalidatorSubscription: subscription cannot be canceled twice");this._isCanceled=!0}this.invalidator.removeSubscription(this);0!==(this.flags&kivi.InvalidatorSubscriptionFlags.COMPONENT)&&this.subscriber.removeSubscription(this)};
kivi.InvalidatorSubscription.prototype.invalidate=function(){0!==(this.flags&kivi.InvalidatorSubscriptionFlags.COMPONENT)?this.subscriber.invalidate():this.subscriber.call()};kivi.scheduler={};kivi.scheduler.FrameFlags={WRITE_PRIO:1,WRITE:2,READ:4,AFTER:8,WRITE_ANY:3};kivi.scheduler.Frame=function(){this.flags=0;this.writeTaskGroups=[];this.focus=this.afterTasks=this.readTasks=this.writeTasks=null};kivi.scheduler.Frame.prototype.updateComponent=function(a){this.write(a,a.depth)};
kivi.scheduler.Frame.prototype.write=function(a,b){var c;void 0===b&&(b=-1);if(-1===b)this.flags|=kivi.scheduler.FrameFlags.WRITE,null===this.writeTasks&&(this.writeTasks=[]),this.writeTasks.push(a);else{for(this.flags|=kivi.scheduler.FrameFlags.WRITE_PRIO;b>=this.writeTaskGroups.length;)this.writeTaskGroups.push(null);c=this.writeTaskGroups[b];null===c&&(c=this.writeTaskGroups[b]=[]);c.push(a)}};
kivi.scheduler.Frame.prototype.read=function(a){this.flags|=kivi.scheduler.FrameFlags.READ;null===this.readTasks&&(this.readTasks=[]);this.readTasks.push(a)};kivi.scheduler.Frame.prototype.after=function(a){this.flags|=kivi.scheduler.FrameFlags.AFTER;null===this.afterTasks&&(this.afterTasks=[]);this.afterTasks.push(a)};kivi.scheduler.Frame.prototype.setFocus=function(a){this.focus=a};kivi.scheduler.PostMessage=function(a){var b=this._message="__pms"+Math.random().toString();window.addEventListener("message",function(c){c.source===window&&c.data===b&&a()})};kivi.scheduler.PostMessage.prototype.requestNextTick=function(){window.postMessage(this._message,"*")};kivi.scheduler.MutationObserver=function(a){this._observer=new window.MutationObserver(a);this._node=document.createTextNode("");this._observer.observe(this._node,{characterData:!0});this._toggle=0};kivi.scheduler.MutationObserver.prototype.requestNextTick=function(){this._toggle^=1;this._node.data=this._toggle.toString()};kivi.ComponentFlags={DISPOSED:1,ATTACHED:2,MOUNTING:4,DIRTY:8,UPDATE_EACH_FRAME:16,IN_UPDATE_QUEUE:32,RECYCLED:kivi.ENABLE_COMPONENT_RECYCLING?64:0,SVG:256,SHOULD_UPDATE_FLAGS:10};kivi.scheduler.SchedulerFlags={RUNNING:256,MICROTASK_PENDING:1,MACROTASK_PENDING:2,FRAMETASK_PENDING:8,MICROTASK_RUNNING:16,MACROTASK_RUNNING:32,FRAMETASK_RUNNING:128};kivi.scheduler._SchedulerTaskList=function(){this._tasks=[];this._tasksWithContext=[]};kivi.scheduler._SchedulerTaskList.prototype.isEmpty=function(){return 0===this._tasks.length&&0===this._tasksWithContext.length};kivi.scheduler._SchedulerTaskList.prototype.addTask=function(a){this._tasks.push(a)};
kivi.scheduler._SchedulerTaskList.prototype.addTaskWithContext=function(a,b){this._tasksWithContext.push(a,b)};kivi.scheduler._SchedulerTaskList.prototype.run=function(){for(var a=0,b=this._tasks;a<b.length;)b[a++]();a=0;for(b=this._tasksWithContext;a<b.length;)b[a].call(b[a+1]),a+=2};
kivi.scheduler.Scheduler=function(){this.flags=0;this.clock=1;this.time=0;this._microtasks=new kivi.scheduler._SchedulerTaskList;this._macrotasks=new kivi.scheduler._SchedulerTaskList;this._currentFrame=new kivi.scheduler.Frame;this._nextFrame=new kivi.scheduler.Frame;this._updateComponents=[];var a=this;this._microtaskScheduler=new kivi.scheduler.MutationObserver(function(){a.flags|=kivi.scheduler.SchedulerFlags.RUNNING;a.time=Date.now();for(var b=a._microtasks;!b.isEmpty();)a._microtasks=new kivi.scheduler._SchedulerTaskList,
b.run(),b=a._microtasks;a.clock++;a.flags&=~(kivi.scheduler.SchedulerFlags.MICROTASK_PENDING|kivi.scheduler.SchedulerFlags.RUNNING)});this._macrotaskScheduler=new kivi.scheduler.PostMessage(function(){a.flags&=~kivi.scheduler.SchedulerFlags.MACROTASK_PENDING;a.flags|=kivi.scheduler.SchedulerFlags.RUNNING;a.time=Date.now();var b=a._macrotasks;b.isEmpty()||(a._macrotasks=new kivi.scheduler._SchedulerTaskList,b.run());a.clock++;a.flags&=~kivi.scheduler.SchedulerFlags.RUNNING});this._handleAnimationFrame=
function(){var b=a._updateComponents,c,d,f,e,g,h;a.flags&=~kivi.scheduler.SchedulerFlags.FRAMETASK_PENDING;a.flags|=kivi.scheduler.SchedulerFlags.RUNNING;a.time=Date.now();c=a._nextFrame;a._nextFrame=a._currentFrame;a._currentFrame=c;for(g=0;g<b.length;g++)b[g].flags|=kivi.ComponentFlags.DIRTY;do{for(;0!==(c.flags&kivi.scheduler.FrameFlags.WRITE_ANY);){if(0!==(c.flags&kivi.scheduler.FrameFlags.WRITE_PRIO))for(c.flags&=~kivi.scheduler.FrameFlags.WRITE_PRIO,d=c.writeTaskGroups,g=0;g<d.length;g++)if(f=
d[g],null!==f)for(d[g]=null,h=0;h<f.length;h++)e=f[h],e.constructor===kivi.Component?e.update():e.call();if(0!==(c.flags&kivi.scheduler.FrameFlags.WRITE))for(c.flags&=~kivi.scheduler.FrameFlags.WRITE,f=c.writeTasks,g=0;g<f.length;g++)e=f[g],e.constructor===kivi.Component?e.update():e.call()}g=0;for(h=b.length;g<h;)e=b[g++],0===(e.flags&kivi.ComponentFlags.UPDATE_EACH_FRAME)?(e.flags&=~kivi.ComponentFlags.IN_UPDATE_QUEUE,g===h?b.pop():b[--g]=b.pop()):e.update();for(;0!==(c.flags&kivi.scheduler.FrameFlags.READ);)for(c.flags&=
~kivi.scheduler.FrameFlags.READ,f=c.readTasks,c.readTasks=null,g=0;g<f.length;g++)e=f[g],e.constructor===kivi.Component?e.update():e.call()}while(0!==(c.flags&kivi.scheduler.FrameFlags.WRITE_ANY));for(;0!==(c.flags&kivi.scheduler.FrameFlags.AFTER);)for(c.flags&=~kivi.scheduler.FrameFlags.AFTER,f=c.afterTasks,g=0;g<f.length;g++)e=f[g],e.constructor===kivi.Component?e.update():e.call();null!==c.focus&&(c.focus.constructor===kivi.VNode?c.focus.ref.focus():c.focus.focus(),c.focus=null);0<b.length&&a.requestAnimationFrame();
a.clock++;a.flags&=~kivi.scheduler.SchedulerFlags.RUNNING}};kivi.scheduler.Scheduler.prototype.requestAnimationFrame=function(){0===(this.flags&kivi.scheduler.SchedulerFlags.FRAMETASK_PENDING)&&(this.flags|=kivi.scheduler.SchedulerFlags.FRAMETASK_PENDING,window.requestAnimationFrame(this._handleAnimationFrame))};kivi.scheduler.Scheduler.prototype.currentFrame=function(){return this._currentFrame};kivi.scheduler.Scheduler.prototype.nextFrame=function(){this.requestAnimationFrame();return this._nextFrame};
kivi.scheduler.Scheduler.prototype.startUpdateComponentEachFrame=function(a){this.requestAnimationFrame();this._updateComponents.push(a)};kivi.scheduler.Scheduler.prototype.scheduleMicrotask=function(a,b){0===(this.flags&kivi.scheduler.SchedulerFlags.MICROTASK_PENDING)&&(this.flags|=kivi.scheduler.SchedulerFlags.MICROTASK_PENDING,this._microtaskScheduler.requestNextTick());void 0===b?this._microtasks.addTask(a):this._microtasks.addTaskWithContext(a,b)};
kivi.scheduler.Scheduler.prototype.scheduleMacrotask=function(a,b){0===(this.flags&kivi.scheduler.SchedulerFlags.MACROTASK_PENDING)&&(this.flags|=kivi.scheduler.SchedulerFlags.MACROTASK_PENDING,this._macrotaskScheduler.requestNextTick());void 0===b?this._macrotasks.addTask(a):this._macrotasks.addTaskWithContext(a,b)};kivi.scheduler.Scheduler.prototype.start=function(a,b){this.flags|=kivi.scheduler.SchedulerFlags.RUNNING;self.time=Date.now();void 0===b?a():a.call(b);this.clock++;this.flags&=~kivi.scheduler.SchedulerFlags.RUNNING};kivi.scheduler.instance=new kivi.scheduler.Scheduler;kivi.Invalidator=function(){this.mtime=kivi.scheduler.instance.clock;this._transientSubscriptions=this._subscriptions=null};kivi.Invalidator.prototype.hasSubscriptions=function(){return null!==this._subscriptions&&(this._subscriptions.constructor===kivi.InvalidatorSubscription||0<this._subscriptions.length)||null!==this._transientSubscriptions&&(this._transientSubscriptions.constructor===kivi.InvalidatorSubscription||0<this._transientSubscriptions.length)};
kivi.Invalidator.prototype.addSubscription=function(a){var b;0===(a.flags&kivi.InvalidatorSubscriptionFlags.TRANSIENT)?(b=this._subscriptions,null===b?this._subscriptions=a:b.constructor===kivi.InvalidatorSubscription?this._subscriptions=[b,a]:b.push(a)):(b=this._transientSubscriptions,null===b?this._transientSubscriptions=a:b.constructor===kivi.InvalidatorSubscription?this._transientSubscriptions=[b,a]:b.push(a))};
kivi.Invalidator.prototype.removeSubscription=function(a){var b;if(0===(a.flags&kivi.InvalidatorSubscriptionFlags.TRANSIENT))if(b=this._subscriptions,b.constructor===kivi.InvalidatorSubscription||1===b.length){if(kivi.DEBUG)if(b.constructor===kivi.InvalidatorSubscription){if(b!==a)throw Error("Failed to remove subscription from Invalidator: cannot find appropriate subscription");}else if(b[0]!==a)throw Error("Failed to remove subscription from Invalidator: cannot find appropriate subscription");this._subscriptions=
null}else{a=b.indexOf(a);if(kivi.DEBUG&&-1===a)throw Error("Failed to remove subscription from Invalidator: cannot find appropriate subscription");b[a]=b.pop()}else if(b=this._transientSubscriptions,null!==b)if(b.constructor===kivi.InvalidatorSubscription||1===b.length){if(kivi.DEBUG)if(b.constructor===kivi.InvalidatorSubscription){if(b!==a)throw Error("Failed to remove subscription from Invalidator: cannot find appropriate subscription");}else if(b[0]!==a)throw Error("Failed to remove subscription from Invalidator: cannot find appropriate subscription");
this._transientSubscriptions=null}else{a=b.indexOf(a);if(kivi.DEBUG&&-1===a)throw Error("Failed to remove subscription from Invalidator: cannot find appropriate subscription");b[a]=b.pop()}};
kivi.Invalidator.prototype.invalidate=function(){var a=kivi.scheduler.instance.clock;if(this.mtime<a){this.mtime=a;var a=this._subscriptions,b;if(null!==a)if(a.constructor===kivi.InvalidatorSubscription)a.invalidate();else for(b=0;b<a.length;b++)a[b].invalidate();a=this._transientSubscriptions;if(null!==a)if(this._transientSubscriptions=null,a.constructor===kivi.InvalidatorSubscription)a.invalidate();else for(b=0;b<a.length;b++)a[b].invalidate()}};kivi.CTagFlags={SVG:1,ENABLE_CLONING:2};kivi.HtmlNamespace={SVG:"http://www.w3.org/2000/svg",XLINK:"http://www.w3.org/1999/xlink",XML:"http://www.w3.org/XML/1998/namespace"};kivi.sync={};kivi.sync._getAttrNamespace=function(a){if(kivi.DEBUG){if("xml"===a.substring(1,4))return kivi.HtmlNamespace.XML;if("xlink"===a.substring(1,6))return kivi.HtmlNamespace.XLINK;throw Error("Invalid attribute namespace: "+a);}return"m"===a[2]?kivi.HtmlNamespace.XML:kivi.HtmlNamespace.XLINK};kivi.sync.setAttr=function(a,b,c){"$"!==b[0]?a.setAttribute(b,c):a.setAttributeNS(kivi.sync._getAttrNamespace(b),b.substring(1),c)};
kivi.sync.removeAttr=function(a,b){"$"!==b[0]?a.removeAttribute(b):a.removeAttributeNS(kivi.sync._getAttrNamespace(b),b.substring(1))};
kivi.sync.staticShapeAttrs=function(a,b,c){var d,f,e,g,h,k;if(kivi.DEBUG&&(null===a||null===b))throw Error("Failed to update attrs with static shape: attrs object have dynamic shape.");g=Object.keys(a);d=0;for(f=g.length;d<f;d++){e=g[d];if(kivi.DEBUG&&!b.hasOwnProperty(e))throw Error("Failed to update attrs with static shape: attrs object have dynamic shape.");h=a[e];k=b[e];h!==k&&kivi.sync.setAttr(c,e,k)}if(kivi.DEBUG)for(g=Object.keys(b),d=0,f=g.length;d<f;d++)if(e=g[d],!a.hasOwnProperty(e))throw Error("Failed to update attrs with static shape: attrs object have dynamic shape.");
};kivi.sync.dynamicShapeAttrs=function(a,b,c){var d,f,e,g,h,k;if(null!==a)if(null===b)for(g=Object.keys(a),d=0,f=g.length;d<f;d++)kivi.sync.removeAttr(c,g[d]);else{g=Object.keys(a);d=0;for(f=g.length;d<f;d++)e=g[d],b.hasOwnProperty(e)?(h=a[e],k=b[e],h!==k&&kivi.sync.setAttr(c,e,k)):kivi.sync.removeAttr(c,e);g=Object.keys(b);d=0;for(f=g.length;d<f;d++)e=g[d],a.hasOwnProperty(e)||kivi.sync.setAttr(c,e,b[e])}else if(null!==b)for(g=Object.keys(b),d=0,f=g.length;d<f;d++)e=g[d],kivi.sync.setAttr(c,e,b[e])};kivi.CTag=function(a,b){this.flags=a;this.tag=b;this.ref=this.classes_=this.style_=this.attrs_=this.props_=null};kivi.CTag.create=function(a){return new kivi.CTag(0,a)};kivi.CTag.createSvg=function(a){return new kivi.CTag(kivi.CTagFlags.SVG,a)};
kivi.CTag.prototype.createElement=function(){var a,b,c,d,f;if(null===this.ref){f=0===(this.flags&kivi.CTagFlags.SVG)?document.createElement(this.tag):document.createElementNS(kivi.HtmlNamespace.SVG,this.tag);if(null!==this.props_)for(c=Object.keys(this.props_),a=0,b=c.length;a<b;a++)d=c[a],f[d]=this.props_[d];if(null!==this.attrs_)for(c=Object.keys(this.attrs_),a=0,b=c.length;a<b;a++)d=c[a],kivi.sync.setAttr(f,d,this.attrs_[d]);null!==this.style_&&(f.style.cssText=this.style_);null!==this.classes_&&
(f.className=this.classes_);0!==(this.flags&kivi.CTagFlags.ENABLE_CLONING)&&(this.ref=f);return f}return this.ref.cloneNode(!1)};kivi.CTag.prototype.props=function(a){this.props_=a;return this};kivi.CTag.prototype.attrs=function(a){this.attrs_=a;return this};kivi.CTag.prototype.style=function(a){this.style_=a;return this};kivi.CTag.prototype.classes=function(a){this.classes_=a;return this};kivi.CTag.prototype.enableCloning=function(){this.flags|=kivi.CTagFlags.ENABLE_CLONING;return this};kivi.CDescriptor=function(a,b){this.flags=void 0===b?0:b;this.tag="div";this.data=this.removeChild=this.moveChild=this.replaceChild=this.insertChild=this.disposed=this.detached=this.attached=this.invalidated=this.update=this.init=this.setChildren=this.setData=null;kivi.ENABLE_COMPONENT_RECYCLING&&(this.recycled=null,this.maxRecycled=0);kivi.DEBUG&&(this.name=a)};kivi.CDescriptor.create=function(a){return new kivi.CDescriptor(a,0)};
kivi.CDescriptor.createSvg=function(a){return new kivi.CDescriptor(a,kivi.CDescriptorFlags.SVG)};kivi.CDescriptor.createWrapper=function(a){var b=new kivi.CDescriptor(a.name,kivi.CDescriptorFlags.WRAPPER);b.flags|=a.flags&kivi.CDescriptorFlags.SVG;b.tag=a.tag;return a};kivi.CDescriptor.prototype.enableRecycling=function(a){kivi.ENABLE_COMPONENT_RECYCLING&&(this.flags|=kivi.CDescriptorFlags.RECYCLE_ENABLED,this.recycled=[],this.maxRecycled=a)};
kivi.CDescriptor.prototype.createComponent=function(a){var b;kivi.ENABLE_COMPONENT_RECYCLING&&0!==(this.flags&kivi.CDescriptorFlags.RECYCLE_ENABLED)&&0!==this.recycled.length?(b=this.recycled.pop(),b.setParent(a)):(b="string"===typeof this.tag?0===(this.flags&kivi.CDescriptorFlags.SVG)?document.createElement(this.tag):document.createElementNS(kivi.HtmlNamespace.SVG,this.tag):this.tag.createElement(),b=new kivi.Component(kivi.ComponentFlags.DIRTY,this,a,b),null!==this.init&&this.init(b));return b};
kivi.CDescriptor.prototype.mountComponent=function(a,b){var c=new kivi.Component(kivi.ComponentFlags.DIRTY|kivi.ComponentFlags.MOUNTING,this,a,b);null!==this.init&&this.init(c);return c};kivi.CDescriptor.prototype.wrapComponent=function(a,b){var c=new kivi.Component(kivi.ComponentFlags.DIRTY,this,a,b);null!==this.init&&this.init(c);return c};
kivi.Component=function(a,b,c,d){this.flags=a;this.mtime=0;this.descriptor=b;this.parent=c;this.depth=null===c?0:c.depth+1;this.children=this.data=this.state=null;this.element=d;this._transientSubscriptions=this._subscriptions=this.root=null;kivi.DEBUG&&!d.getAttribute("data-kivi-component")&&(d.setAttribute("data-kivi-component",b.name),d._kiviComponent=this)};kivi.Component.prototype.markDirty=function(){this.flags|=kivi.ComponentFlags.DIRTY};
kivi.Component.prototype.setParent=function(a){this.parent=a;this.depth=null===a?0:a.depth+1};kivi.Component.prototype.setData=function(a){var b=this.descriptor.setData;null===b?this.data!==a&&(this.data=a,this.flags|=kivi.ComponentFlags.DIRTY):b(this,a)};kivi.Component.prototype.setChildren=function(a){var b=this.descriptor.setChildren;null!==b&&b(this,a)};
kivi.Component.prototype.update=function(){(this.flags&kivi.ComponentFlags.SHOULD_UPDATE_FLAGS)===kivi.ComponentFlags.SHOULD_UPDATE_FLAGS&&(this.descriptor.update(this),this.mtime=kivi.scheduler.instance.clock,this.flags&=~kivi.ComponentFlags.DIRTY)};
kivi.Component.prototype.syncVRoot=function(a){null===this.root?(a.cref=this,0!==(this.flags&kivi.ComponentFlags.MOUNTING)?(a.mount(this.element,this),this.flags&=~kivi.ComponentFlags.MOUNTING):(a.ref=this.element,a.render(this))):this.root.sync(a,this);this.root=a};
kivi.Component.prototype.syncComponent=function(a,b){void 0===b&&(b=null);var c=this.root;null===c&&(c=this.descriptor.data,c=0===(this.flags&kivi.ComponentFlags.MOUNTING)?c.wrapComponent(this,this.element):c.mountComponent(this,this.element));c.setData(a);c.setChildren(b);c.update()};kivi.Component.prototype.invalidate=function(){0===(this.flags&(kivi.ComponentFlags.DIRTY|kivi.ComponentFlags.DISPOSED))&&(this.flags|=kivi.ComponentFlags.DIRTY,this.cancelTransientSubscriptions(),kivi.scheduler.instance.nextFrame().updateComponent(this))};
kivi.Component.prototype.startUpdateEachFrame=function(){this.flags|=kivi.ComponentFlags.UPDATE_EACH_FRAME;0===(this.flags&kivi.ComponentFlags.IN_UPDATE_QUEUE)&&(this.flags|=kivi.ComponentFlags.IN_UPDATE_QUEUE,kivi.scheduler.instance.startUpdateComponentEachFrame(this))};kivi.Component.prototype.stopUpdateEachFrame=function(){this.flags&=~kivi.ComponentFlags.UPDATE_EACH_FRAME};kivi.Component.prototype.attach=function(){this.attached();var a=this.root;null!==a&&a.attach()};
kivi.Component.prototype.attached=function(){if(kivi.DEBUG&&0!==(this.flags&kivi.ComponentFlags.ATTACHED))throw Error("Failed to attach Component: component is already attached.");this.flags|=kivi.ComponentFlags.ATTACHED;kivi.ENABLE_COMPONENT_RECYCLING&&(this.flags&=~kivi.ComponentFlags.RECYCLED);var a=this.descriptor.attached;null!==a&&a(this)};kivi.Component.prototype.detach=function(){var a=this.root;null!==a&&a.detach();this.detached()};
kivi.Component.prototype.detached=function(){if(kivi.DEBUG&&0===(this.flags&kivi.ComponentFlags.ATTACHED))throw Error("Failed to detach Component: component is already detached.");this.flags&=~(kivi.ComponentFlags.ATTACHED|kivi.ComponentFlags.UPDATE_EACH_FRAME);this.cancelSubscriptions();this.cancelTransientSubscriptions();var a=this.descriptor.detached;null!==a&&a(this)};
kivi.Component.prototype.dispose=function(){if(kivi.DEBUG&&0!==(this.flags&kivi.ComponentFlags.DISPOSED))throw Error("Failed to dispose Component: component is already disposed");var a=this.descriptor;if(!kivi.ENABLE_COMPONENT_RECYCLING||0===(a.flags&kivi.CDescriptorFlags.RECYCLE_ENABLED)||a.recycled.length>=a.maxRecycled){this.flags|=kivi.ComponentFlags.DISPOSED;var b=this.root;null!==b&&b.dispose();this.detached();null!==a.disposed&&a.disposed(this)}else this.detach(),a.recycled.push(this)};
kivi.Component.prototype.subscribe=function(a){var b=new kivi.InvalidatorSubscription(kivi.InvalidatorSubscriptionFlags.COMPONENT,a,this);a.addSubscription(b);a=this._subscriptions;null===a?this._subscriptions=b:a.constructor===kivi.InvalidatorSubscription?this._subscriptions=[this._subscriptions,b]:a.push(b)};
kivi.Component.prototype.transientSubscribe=function(a){var b=new kivi.InvalidatorSubscription(kivi.InvalidatorSubscriptionFlags.COMPONENT|kivi.InvalidatorSubscriptionFlags.TRANSIENT,a,this);a.addSubscription(b);a=this._transientSubscriptions;null===a?this._transientSubscriptions=b:a.constructor===kivi.InvalidatorSubscription?this._transientSubscriptions=[this._transientSubscriptions,b]:a.push(b)};
kivi.Component.prototype.removeSubscription=function(a){var b;if(0===(a.flags&kivi.InvalidatorSubscriptionFlags.TRANSIENT))if(b=this._subscriptions,b.constructor===kivi.InvalidatorSubscription||1===b.length){if(kivi.DEBUG)if(b.constructor===kivi.InvalidatorSubscription){if(b!==a)throw Error("Failed to remove subscription from Component: cannot find appropriate subscription");}else if(b[0]!==a)throw Error("Failed to remove subscription from Component: cannot find appropriate subscription");this._subscriptions=
null}else{a=b.indexOf(a);if(kivi.DEBUG&&-1===a)throw Error("Failed to remove subscription from Component: cannot find appropriate subscription");b[a]=b.pop()}else if(b=this._transientSubscriptions,b.constructor===kivi.InvalidatorSubscription||1===b.length){if(kivi.DEBUG)if(b.constructor===kivi.InvalidatorSubscription){if(b!==a)throw Error("Failed to remove subscription from Component: cannot find appropriate subscription");}else if(b[0]!==a)throw Error("Failed to remove subscription from Component: cannot find appropriate subscription");
this._transientSubscriptions=null}else{a=b.indexOf(a);if(kivi.DEBUG&&-1===a)throw Error("Failed to remove subscription from Component: cannot find appropriate subscription");b[a]=b.pop()}};kivi.Component.prototype.cancelSubscriptions=function(){var a=this._subscriptions;if(null!==a)if(a.constructor===kivi.InvalidatorSubscription)a.invalidator.removeSubscription(a);else for(var b=0;b<a.length;b++){var c=a[b];c.invalidator.removeSubscription(c)}this._subscriptions=null};
kivi.Component.prototype.cancelTransientSubscriptions=function(){var a=this._transientSubscriptions;if(null!==a)if(a.constructor===kivi.InvalidatorSubscription)a.invalidator.removeSubscription(a);else for(var b=0;b<a.length;b++){var c=a[b];c.invalidator.removeSubscription(c)}this._transientSubscriptions=null};kivi.debug={};kivi.debug.printError=function(a){console.error(a);try{throw Error(a);}catch(b){}};kivi.VNodeFlags={TEXT:1,ELEMENT:2,COMPONENT:4,ROOT:8,SVG:16,TRACK_BY_KEY:32,MANAGED_CONTAINER:64,TEXT_INPUT_ELEMENT:256,CHECKED_INPUT_ELEMENT:512,INPUT_ELEMENT:768,COMMENT_PLACEHOLDER:16384,DYNAMIC_SHAPE_ATTRS:65536,DYNAMIC_SHAPE_PROPS:131072};kivi.VNodeDebugFlags={RENDERED:1,MOUNTED:2,ATTACHED:4,DETACHED:8,DISPOSED:16,DISABLE_CHILDREN_SHAPE_ERROR:32,DISABLE_FREEZE:64};kivi.sync.staticShapeProps=function(a,b,c){var d,f,e,g,h,k;if(kivi.DEBUG&&(null===a||null===b))throw Error("Failed to update props with static shape: props object have dynamic shape.");g=Object.keys(a);d=0;for(f=g.length;d<f;d++){e=g[d];if(kivi.DEBUG&&!b.hasOwnProperty(e))throw Error("Failed to update props with static shape: props object have dynamic shape.");h=a[e];k=b[e];h!==k&&(c[e]=k)}if(kivi.DEBUG)for(g=Object.keys(b),d=0,f=g.length;d<f;d++)if(e=g[d],!a.hasOwnProperty(e))throw Error("Failed to update props with static shape: props object have dynamic shape.");
};kivi.sync.dynamicShapeProps=function(a,b,c){var d,f,e,g,h,k;if(null!==a)if(null===b)for(g=Object.keys(a),d=0,f=g.length;d<f;d++)c[g[d]]=void 0;else{g=Object.keys(a);d=0;for(f=g.length;d<f;d++)e=g[d],b.hasOwnProperty(e)?(h=a[e],k=b[e],h!==k&&(c[e]=k)):c[e]=void 0;g=Object.keys(b);d=0;for(f=g.length;d<f;d++)e=g[d],a.hasOwnProperty(e)||(c[e]=b[e])}else if(null!==b)for(g=Object.keys(b),d=0,f=g.length;d<f;d++)e=g[d],c[e]=b[e]};kivi.VNode=function(a,b,c){this.flags=a;this.tag=b;this.key_=null;this.props_=c;this.cref=this.ref=this.children_=this.classes_=this.style_=this.attrs_=null;kivi.DEBUG&&(this._debugProperties={flags:0})};kivi.VNode.createText=function(a){return new kivi.VNode(kivi.VNodeFlags.TEXT,null,a)};kivi.VNode.createElement=function(a){return new kivi.VNode(kivi.VNodeFlags.ELEMENT,a,null)};kivi.VNode.createSvgElement=function(a){return new kivi.VNode(kivi.VNodeFlags.ELEMENT|kivi.VNodeFlags.SVG,a,null)};
kivi.VNode.createTextInput=function(a){return new kivi.VNode(kivi.VNodeFlags.ELEMENT|kivi.VNodeFlags.TEXT_INPUT_ELEMENT,void 0===a?"input":a,null)};kivi.VNode.createCheckedInput=function(a){return new kivi.VNode(kivi.VNodeFlags.ELEMENT|kivi.VNodeFlags.CHECKED_INPUT_ELEMENT,void 0===a?"input":a,null)};kivi.VNode.createComponent=function(a,b){void 0===b&&(b=null);return new kivi.VNode(kivi.VNodeFlags.COMPONENT,a,b)};kivi.VNode.createRoot=function(){return new kivi.VNode(kivi.VNodeFlags.ROOT,null,null)};
kivi.VNode.prototype.key=function(a){this.key_=a;return this};kivi.VNode.prototype.props=function(a){if(kivi.DEBUG&&0===(this.flags&(kivi.VNodeFlags.ELEMENT|kivi.VNodeFlags.ROOT)))throw Error("Failed to set props on VNode: props method should be called on element or component root nodes only.");this.props_=a;return this};
kivi.VNode.prototype.dynamicProps=function(a){if(kivi.DEBUG&&0===(this.flags&(kivi.VNodeFlags.ELEMENT|kivi.VNodeFlags.ROOT)))throw Error("Failed to set props on VNode: props method should be called on element or component root nodes only.");this.flags|=kivi.VNodeFlags.DYNAMIC_SHAPE_PROPS;this.props_=a;return this};
kivi.VNode.prototype.data=function(a){if(kivi.DEBUG&&0===(this.flags&kivi.VNodeFlags.COMPONENT))throw Error("Failed to set data on VNode: data method should be called on component nodes only.");this.props_=a;return this};kivi.VNode.prototype.attrs=function(a){if(kivi.DEBUG&&0===(this.flags&(kivi.VNodeFlags.ELEMENT|kivi.VNodeFlags.ROOT)))throw Error("Failed to set attrs on VNode: attrs method should be called on element or component root nodes only.");this.attrs_=a;return this};
kivi.VNode.prototype.dynamicShapeAttrs=function(a){if(kivi.DEBUG&&0===(this.flags&(kivi.VNodeFlags.ELEMENT|kivi.VNodeFlags.ROOT)))throw Error("Failed to set attrs on VNode: dynamicAttrs method should be called on element or component root nodes only.");this.flags|=kivi.VNodeFlags.DYNAMIC_SHAPE_ATTRS;this.attrs_=a;return this};
kivi.VNode.prototype.style=function(a){if(kivi.DEBUG&&0===(this.flags&(kivi.VNodeFlags.ELEMENT|kivi.VNodeFlags.ROOT)))throw Error("Failed to set style on VNode: style method should be called on element or component root nodes only.");this.style_=a;return this};
kivi.VNode.prototype.classes=function(a){if(kivi.DEBUG&&0===(this.flags&(kivi.VNodeFlags.ELEMENT|kivi.VNodeFlags.ROOT|kivi.VNodeFlags.COMPONENT)))throw Error("Failed to set classes on VNode: classes method should be called on element, component or component root nodes only.");this.classes_=a;return this};
kivi.VNode.prototype.children=function(a){if(kivi.DEBUG&&0===(this.flags&(kivi.VNodeFlags.ELEMENT|kivi.VNodeFlags.ROOT|kivi.VNodeFlags.COMPONENT)))throw Error("Failed to set children on VNode: children method should be called on element, component or component root nodes only.");this.children_=a;return this};
kivi.VNode.prototype.value=function(a){if(kivi.DEBUG&&0===(this.flags&(kivi.VNodeFlags.ELEMENT|kivi.VNodeFlags.TEXT_INPUT_ELEMENT)))throw Error("Failed to set value on VNode: value method should be called on input elements.");this.children_=a;return this};
kivi.VNode.prototype.checked=function(a){if(kivi.DEBUG&&0===(this.flags&(kivi.VNodeFlags.ELEMENT|kivi.VNodeFlags.CHECKED_INPUT_ELEMENT)))throw Error("Failed to set value on VNode: value method should be called on input elements.");this.children_=a;return this};
kivi.VNode.prototype.trackByKey=function(){if(kivi.DEBUG&&0===(this.flags&(kivi.VNodeFlags.ELEMENT|kivi.VNodeFlags.ROOT)))throw Error("Failed to set trackByKey mode on VNode: trackByKey method should be called on element or component root nodes only.");this.flags|=kivi.VNodeFlags.TRACK_BY_KEY;return this};
kivi.VNode.prototype.managedContainer=function(){if(kivi.DEBUG&&0===(this.flags&(kivi.VNodeFlags.ELEMENT|kivi.VNodeFlags.ROOT)))throw Error("Failed to set managedContainer mode on VNode: managedContainer method should be called on element or component root nodes only.");this.flags|=kivi.VNodeFlags.MANAGED_CONTAINER;return this};
kivi.VNode.prototype.disableChildrenShapeError=function(){if(kivi.DEBUG){if(0===(this.flags&(kivi.VNodeFlags.ELEMENT|kivi.VNodeFlags.ROOT)))throw Error("Failed to disable children shape error on VNode: disableChildrenShapeError method should be called on element or component root nodes only.");this._debugProperties.flags|=kivi.VNodeDebugFlags.DISABLE_CHILDREN_SHAPE_ERROR}return this};
kivi.VNode.prototype.disableFreeze=function(){kivi.DEBUG&&(this._debugProperties.flags|=kivi.VNodeDebugFlags.DISABLE_FREEZE);return this};kivi.VNode.prototype._canSync=function(a){return this.flags===a.flags&&this.tag===a.tag&&this.key_===a.key_};
kivi.VNode.prototype.create=function(a){var b=this.flags;if(kivi.DEBUG){if(null!==this.ref&&0===(b&kivi.VNodeFlags.COMMENT_PLACEHOLDER))throw Error("Failed to create VNode: VNode already has a reference to the DOM node.");this.flags&=~kivi.VNodeFlags.COMMENT_PLACEHOLDER}0!==(b&kivi.VNodeFlags.TEXT)?this.ref=document.createTextNode(this.props_):0!==(b&kivi.VNodeFlags.ELEMENT)?this.ref="string"===typeof this.tag?0===(b&kivi.VNodeFlags.SVG)?document.createElement(this.tag):document.createElementNS(kivi.HtmlNamespace.SVG,
this.tag):this.tag.createElement():0!==(b&kivi.VNodeFlags.COMPONENT)&&(a=this.tag.createComponent(a),this.ref=a.element,this.cref=a)};kivi.VNode.prototype.createCommentPlaceholder=function(){if(kivi.DEBUG){if(null!==this.ref)throw Error("Failed to create VNode Comment Placeholder: VNode already has a reference to the DOM node.");this.flags|=kivi.VNodeFlags.COMMENT_PLACEHOLDER}this.ref=document.createComment("")};
kivi.VNode.prototype.render=function(a){var b;if(kivi.DEBUG){if(null===this.ref)throw Error("Failed to render VNode: VNode should be created before render.");if(0!==(this.flags&kivi.VNodeFlags.COMMENT_PLACEHOLDER))throw Error("Failed to render VNode: VNode comment placeholder cannot be rendered.");if(0!==(this._debugProperties.flags&kivi.VNodeDebugFlags.RENDERED))throw Error("Failed to render VNode: VNode cannot be rendered twice.");if(0!==(this._debugProperties.flags&kivi.VNodeDebugFlags.MOUNTED))throw Error("Failed to render VNode: VNode cannot be rendered after mount.");
this._debugProperties.flags|=kivi.VNodeDebugFlags.RENDERED;if(null!==this.children_&&"string"!==typeof this.children_&&0!==(this.flags&kivi.VNodeFlags.TRACK_BY_KEY))for(b=0;b<this.children_.length;b++)if(null===this.children_[b].key_)throw Error("Failed to render VNode: rendering children with trackByKey requires that all children have keys.");}var c,d,f,e=this.flags,g;if(0!==(e&(kivi.VNodeFlags.ELEMENT|kivi.VNodeFlags.ROOT))){g=this.ref;var h=this.props_;if(null!==h)for(f=Object.keys(h),b=0,c=f.length;b<
c;b++)d=f[b],g[d]=h[d];if(null!==this.attrs_)for(f=Object.keys(this.attrs_),b=0,c=f.length;b<c;b++)d=f[b],kivi.sync.setAttr(g,d,this.attrs_[d]);null!==this.style_&&(0===(e&kivi.VNodeFlags.SVG)?g.style.cssText=this.style_:g.setAttribute("style",this.style_));null!==this.classes_&&(kivi.DEBUG&&(b=g.getAttribute("class"),0!==(e&kivi.VNodeFlags.ROOT)&&b&&kivi.debug.printError("VNode render: Component root node overwrited className property"+(' "'+b+'" with "'+this.classes_+'".'))),0===(e&kivi.VNodeFlags.SVG)?
g.className=this.classes_:g.setAttribute("class",this.classes_));e=this.children_;if(null!==e)if(0===(this.flags&kivi.VNodeFlags.INPUT_ELEMENT))if("string"===typeof e)g.textContent=e;else for(b=0,c=e.length;b<c;b++)this._insertChild(e[b],null,a);else g=this.ref,0!==(this.flags&kivi.VNodeFlags.TEXT_INPUT_ELEMENT)?g.value=this.children_:g.checked=this.children_}else 0!==(e&kivi.VNodeFlags.COMPONENT)&&(a=this.cref,g=this.ref,null!==this.classes_&&(0===(e&kivi.VNodeFlags.SVG)?g.className=this.classes_:
g.setAttribute("class",this.classes_)),a.setData(this.props_),a.setChildren(this.children_),a.update());this._freeze()};
kivi.VNode.prototype.mount=function(a,b){if(kivi.DEBUG){if(null!==this.ref)throw Error("Failed to mount VNode: VNode cannot be mounted if it already has a reference to DOM Node.");if(0!==(this.flags&kivi.VNodeFlags.COMMENT_PLACEHOLDER))throw Error("Failed to mount VNode: VNode comment placeholder cannot be mounted.");if(0!==(this._debugProperties.flags&kivi.VNodeDebugFlags.RENDERED))throw Error("Failed to mount VNode: VNode cannot be mounted after render.");if(0!==(this._debugProperties.flags&kivi.VNodeDebugFlags.MOUNTED))throw Error("Failed to mount VNode: VNode cannot be mounted twice.");
this._debugProperties.flags|=kivi.VNodeDebugFlags.MOUNTED}var c=this.flags,d=this.children_,f;if(kivi.DEBUG&&null!==d&&"string"!==typeof d&&0!==(c&kivi.VNodeFlags.TRACK_BY_KEY))for(f=0;f<d.length;f++)if(null===d[f].key_)throw Error("Failed to mount VNode: mounting children with trackByKey requires that all children have keys.");this.ref=a;if(0!==(c&kivi.VNodeFlags.COMPONENT))d=this.cref=this.tag.mountComponent(b,a),d.setData(this.props_),d.setChildren(this.children_),d.update();else if(null!==d&&
"string"!==typeof d&&0<d.length){for(var c=a.firstChild,e;8===c.nodeType;)e=c,c=c.nextSibling,a.removeChild(e);for(f=0;f<d.length;f++){if(kivi.DEBUG&&!c)throw Error("Failed to mount VNode: cannot find matching node.");d[f].mount(c,b);for(c=c.nextSibling;8===c.nodeType;)e=c,c=c.nextSibling,a.removeChild(e)}}this._freeze()};
kivi.VNode.prototype.sync=function(a,b){if(kivi.DEBUG){if(0===(this._debugProperties.flags&(kivi.VNodeDebugFlags.RENDERED|kivi.VNodeDebugFlags.MOUNTED)))throw Error("Failed to sync VNode: VNode should be rendered or mounted before sync.");a._debugProperties.flags|=this._debugProperties.flags&(kivi.VNodeDebugFlags.RENDERED|kivi.VNodeDebugFlags.MOUNTED|kivi.VNodeDebugFlags.ATTACHED|kivi.VNodeDebugFlags.DETACHED)}var c=this.ref,d=this.flags,f;if(kivi.DEBUG){if(this.flags!==a.flags)throw Error("Failed to sync VNode: flags does not match (old: "+
this.flags+", new: "+a.flags+")");if(this.tag!==a.tag)throw Error("Failed to sync VNode: tags does not match (old: "+this.tag+", new: "+a.tag+")");if(this.key_!==a.key_)throw Error("Failed to sync VNode: keys does not match (old: "+this.key_+", new: "+a.key_+")");if(null!==a.ref&&this.ref!==a.ref)throw Error("Failed to sync VNode: reusing VNodes isn't allowed unless it has the same ref.");if(null!==a.children_&&"string"!==typeof a.children_&&0!==(a.flags&kivi.VNodeFlags.TRACK_BY_KEY))for(f=0;f<a.children_.length;f++)if(null===
a.children_[f].key_)throw Error("Failed to sync VNode: syncing children with trackByKey requires that all children have keys.");}a.ref=c;0!==(d&kivi.VNodeFlags.TEXT)?this.props_!==a.props_&&(this.ref.nodeValue=a.props_):0!==(d&(kivi.VNodeFlags.ELEMENT|kivi.VNodeFlags.ROOT))?(this.props_!==a.props_&&(0===(this.flags&kivi.VNodeFlags.DYNAMIC_SHAPE_PROPS)?kivi.sync.staticShapeProps(this.props_,a.props_,c):kivi.sync.dynamicShapeProps(this.props_,a.props_,c)),this.attrs_!==a.attrs_&&(0===(this.flags&kivi.VNodeFlags.DYNAMIC_SHAPE_ATTRS)?
kivi.sync.staticShapeAttrs(this.attrs_,a.attrs_,c):kivi.sync.dynamicShapeAttrs(this.attrs_,a.attrs_,c)),this.style_!==a.style_&&(f=null===a.style_?"":a.style_,0===(d&kivi.VNodeFlags.SVG)?c.style.cssText=f:c.setAttribute("style",f)),this.classes_!==a.classes_&&(f=null===a.classes_?"":a.classes_,0===(d&kivi.VNodeFlags.SVG)?c.className=f:c.setAttribute("class",f)),0===(this.flags&kivi.VNodeFlags.INPUT_ELEMENT)?this.children_!==a.children_&&this.syncChildren(this.children_,a.children_,b):0!==(d&kivi.VNodeFlags.TEXT_INPUT_ELEMENT)?
c.value!==a.children_&&(c.value=a.children_):c.checked!==a.children_&&(c.checked=a.children_)):0!==(d&kivi.VNodeFlags.COMPONENT)&&(this.classes_!==a.classes_&&(f=null===a.classes_?"":a.classes_,0===(d&kivi.VNodeFlags.SVG)?c.className=f:c.setAttribute("class",f)),c=a.cref=this.cref,c.setData(a.props_),c.setChildren(a.children_),c.update());a._freeze()};
kivi.VNode.prototype.attach=function(){if(kivi.DEBUG){if(0!==(this._debugProperties.flags&kivi.VNodeDebugFlags.ATTACHED))throw Error("Failed to attach VNode: VNode is already attached.");this._debugProperties.flags|=kivi.VNodeDebugFlags.ATTACHED;this._debugProperties.flags&=~kivi.VNodeDebugFlags.DETACHED}if(0===(this.flags&kivi.VNodeFlags.COMPONENT)){var a=this.children_;if(null!==a&&"string"!==typeof a)for(var b=0;b<a.length;b++)a[b].attach()}else this.cref.attach()};
kivi.VNode.prototype.attached=function(){if(kivi.DEBUG){if(0!==(this._debugProperties.flags&kivi.VNodeDebugFlags.ATTACHED))throw Error("Failed to attach VNode: VNode is already attached.");this._debugProperties.flags|=kivi.VNodeDebugFlags.ATTACHED;this._debugProperties.flags&=~kivi.VNodeDebugFlags.DETACHED}0!==(this.flags&kivi.VNodeFlags.COMPONENT)&&this.cref.attach()};
kivi.VNode.prototype.detach=function(){if(kivi.DEBUG){if(0!==(this._debugProperties.flags&kivi.VNodeDebugFlags.DETACHED))throw Error("Failed to detach VNode: VNode is already detached.");this._debugProperties.flags|=kivi.VNodeDebugFlags.DETACHED;this._debugProperties.flags&=~kivi.VNodeDebugFlags.ATTACHED}if(0===(this.flags&kivi.VNodeFlags.COMPONENT)){var a=this.children_;if(null!==a&&"string"!==typeof a)for(var b=0;b<a.length;b++)a[b].detach()}else null===this.cref&&console.error(this),this.cref.detach()};
kivi.VNode.prototype.detached=function(){if(kivi.DEBUG){if(0!==(this._debugProperties.flags&kivi.VNodeDebugFlags.DETACHED))throw Error("Failed to detach VNode: VNode is already detached.");this._debugProperties.flags|=kivi.VNodeDebugFlags.DETACHED;this._debugProperties.flags&=~kivi.VNodeDebugFlags.ATTACHED}0!==(this.flags&kivi.VNodeFlags.COMPONENT)&&this.cref.detach()};
kivi.VNode.prototype.dispose=function(){if(kivi.DEBUG){if(0!==(this._debugProperties.flags&kivi.VNodeDebugFlags.DISPOSED))throw Error("Failed to dispose VNode: VNode is already disposed.");if(0===(this._debugProperties.flags&(kivi.VNodeDebugFlags.RENDERED|kivi.VNodeDebugFlags.MOUNTED)))throw Error("Failed to dispose VNode: VNode should be rendered or mounted before disposing.");this._debugProperties.flags|=kivi.VNodeDebugFlags.DISPOSED}if(0!==(this.flags&kivi.VNodeFlags.COMPONENT))this.cref.dispose();
else if(null!==this.children_){var a=this.children_;if("string"!==typeof a)for(var b=0;b<a.length;b++)a[b].dispose()}};
kivi.VNode.prototype._freeze=function(){kivi.DEBUG&&0===(this._debugProperties.flags&kivi.VNodeDebugFlags.DISABLE_FREEZE)&&(Object.freeze(this),null===this.attrs_||Object.isFrozen(this.attrs_)||Object.freeze(this.attrs_),0!==(this.flags&kivi.VNodeFlags.COMPONENT)||null===this.props_||Object.isFrozen(this.props_)||Object.freeze(this.props_),null!==this.children_&&Array.isArray(this.children_)&&!Object.isFrozen(this.children_)&&Object.freeze(this.children_))};
kivi.VNode.prototype._insertChild=function(a,b,c){0!==(this.flags&kivi.VNodeFlags.MANAGED_CONTAINER)&&null!==c.descriptor.insertChild?c.descriptor.insertChild(c,this,a,b):(a.create(c),this.ref.insertBefore(a.ref,b),a.attached(),a.render(c))};kivi.VNode.prototype._replaceChild=function(a,b,c){0!==(this.flags&kivi.VNodeFlags.MANAGED_CONTAINER)&&null!==c.descriptor.replaceChild?c.descriptor.replaceChild(c,this,a,b):(a.create(c),this.ref.replaceChild(a.ref,b.ref),b.dispose(),a.attached(),a.render(c))};
kivi.VNode.prototype._moveChild=function(a,b,c){0!==(this.flags&kivi.VNodeFlags.MANAGED_CONTAINER)&&null!==c.descriptor.moveChild?c.descriptor.moveChild(c,this,a,b):this.ref.insertBefore(a.ref,b)};kivi.VNode.prototype._removeChild=function(a,b){0!==(this.flags&kivi.VNodeFlags.MANAGED_CONTAINER)&&null!==b.descriptor.removeChild?b.descriptor.removeChild(b,this,a):(this.ref.removeChild(a.ref),a.dispose())};
kivi.VNode.prototype.syncChildren=function(a,b,c){var d,f,e=0,g=!1;if(kivi.DEBUG&&0!==(this.flags&kivi.VNodeFlags.TRACK_BY_KEY)&&("string"===typeof a||"string"===typeof b))throw Error("VNode sync children failed: children property cannot have type string when track by key is enabled.");if("string"===typeof a)if(null===b)this.ref.removeChild(this.ref.firstChild);else if("string"===typeof b)(a=this.ref.firstChild)?a.nodeValue=b:this.ref.textContent=b;else for(this.ref.removeChild(this.ref.firstChild);e<
b.length;)this._insertChild(b[e++],null,c);else if("string"===typeof b){if(null!==a)for(;e<a.length;)this._removeChild(a[e++],c);this.ref.textContent=b}else if(null!==a&&0!==a.length)if(null===b||0===b.length)for(;e<a.length;)this._removeChild(a[e++],c);else if(1===a.length&&1===b.length)d=a[0],f=b[0],d._canSync(f)?d.sync(f,c):this._replaceChild(f,d,c);else if(1===a.length){d=a[0];if(0===(this.flags&kivi.VNodeFlags.TRACK_BY_KEY))for(kivi.DEBUG&&0===(this._debugProperties.flags&kivi.VNodeDebugFlags.DISABLE_CHILDREN_SHAPE_ERROR)&&
kivi.debug.printError("VNode sync children: children shape is changing, you should enable tracking by key with VNode method trackByKey().\nIf you certain that children shape changes won't cause any problems with losing state, you can remove this warning with VNode method disableChildrenShapeError().");e<b.length;){f=b[e++];if(d._canSync(f)){d.sync(f,c);g=!0;break}this._insertChild(f,d.ref,c)}else for(;e<b.length;){f=b[e++];if(d.key_===f.key_){if(kivi.DEBUG&&!d._canSync(f))throw Error("VNode sync children failed: cannot sync two different children with the same key.");
d.sync(f,c);g=!0;break}this._insertChild(f,d.ref,c)}if(g)for(;e<b.length;)this._insertChild(b[e++],null,c);else this._removeChild(d,c)}else if(1===b.length){f=b[0];if(0===(this.flags&kivi.VNodeFlags.TRACK_BY_KEY))for(kivi.DEBUG&&0===(this._debugProperties.flags&kivi.VNodeDebugFlags.DISABLE_CHILDREN_SHAPE_ERROR)&&kivi.debug.printError("VNode sync children: children shape is changing, you should enable tracking by key with VNode method trackByKey().\nIf you certain that children shape changes won't cause any problems with losing state, you can remove this warning with VNode method disableChildrenShapeError().");e<
a.length;){d=a[e++];if(d._canSync(f)){d.sync(f,c);g=!0;break}this._removeChild(d,c)}else for(;e<a.length;){d=a[e++];if(d.key_===f.key_){if(kivi.DEBUG&&!d._canSync(f))throw Error("VNode sync children failed: cannot sync two different children with the same key.");d.sync(f,c);g=!0;break}this._removeChild(d,c)}if(g)for(;e<a.length;)this._removeChild(a[e++],c);else this._insertChild(f,null,c)}else 0===(this.flags&kivi.VNodeFlags.TRACK_BY_KEY)?this._syncChildren(a,b,c):this._syncChildrenTrackingByKeys(a,
b,c);else if(null!==b&&0<b.length)for(e=0;e<b.length;e++)this._insertChild(b[e],null,c)};
kivi.VNode.prototype._syncChildren=function(a,b,c){for(var d=0,f=0,e=a.length-1,g=b.length-1,h,k;d<=e&&f<=g;){h=a[d];k=b[f];if(!h._canSync(k))break;d++;f++;h.sync(k,c)}for(;d<=e&&f<=g;){h=a[e];k=b[g];if(!h._canSync(k))break;e--;g--;h.sync(k,c)}for(kivi.DEBUG&&(d<=e||f<=g)&&0===(this._debugProperties.flags&kivi.VNodeDebugFlags.DISABLE_CHILDREN_SHAPE_ERROR)&&kivi.debug.printError("VNode sync children: children shape is changing, you should enable tracking by key with VNode method trackByKey().\nIf you certain that children shape changes won't cause any problems with losing state, you can remove this warning with VNode method disableChildrenShapeError().");d<=e&&
f<=g;)h=a[d++],k=b[f++],h._canSync(k)?h.sync(k,c):this._replaceChild(k,h,c);if(d<=e){do this._removeChild(a[d++],c);while(d<=e)}else if(f<=g){a=g+1;a=a<b.length?b[a].ref:null;do this._insertChild(b[f++],a,c);while(f<=g)}};
kivi.VNode.prototype._syncChildrenTrackingByKeys=function(a,b,c){var d=0,f=0,e=a.length-1,g=b.length-1,h=a[d],k=b[f],m=a[e],l=b[g],n=!1,p,r=0;a:do{for(n=!0;h.key_===k.key_;){if(kivi.DEBUG&&!h._canSync(k))throw Error("VNode sync children failed: cannot sync two different children with the same key.");h.sync(k,c);d++;f++;if(d>e||f>g)break a;h=a[d];k=b[f];n=!1}for(;m.key_===l.key_;){if(kivi.DEBUG&&!m._canSync(l))throw Error("VNode sync children failed: cannot sync two different children with the same key.");
m.sync(l,c);e--;g--;if(d>e||f>g)break a;m=a[e];l=b[g];n=!1}for(;h.key_===l.key_;){if(kivi.DEBUG&&!h._canSync(l))throw Error("VNode sync children failed: cannot sync two different children with the same key.");h.sync(l,c);h=g+1;h=h<b.length?b[h].ref:null;this._moveChild(l,h,c);d++;g--;if(d>e||f>g)break a;h=a[d];l=b[g];n=!1;continue a}for(;m.key_===k.key_;){if(kivi.DEBUG&&!m._canSync(k))throw Error("VNode sync children failed: cannot sync two different children with the same key.");m.sync(k,c);this._moveChild(k,
h.ref,c);e--;f++;if(d>e||f>g)break a;m=a[e];k=b[f];n=!1}}while(!n&&d<=e&&f<=g);if(d>e)for(h=g+1,h=h<b.length?b[h].ref:null;f<=g;)this._insertChild(b[f++],h,c);else if(f>g)for(;d<=e;)this._removeChild(a[d++],c);else{n=e-d+1;h=g-f+1;m=Array(h);for(k=0;k<h;k++)m[k]=-1;var t=!1,u=0;if(16>=n*h)for(k=d;k<=e;k++){for(var q=!0,l=a[k],d=f;d<=g;d++)if(p=b[d],l.key_===p.key_){m[d-f]=k;r>d?t=!0:r=d;if(kivi.DEBUG&&!l._canSync(p))throw Error("VNode sync children failed: cannot sync two different children with the same key.");
l.sync(p,c);q=!1;break}q&&(this._removeChild(l,c),u++)}else{q=new Map;for(k=f;k<=g;k++)l=b[k],q.set(l.key_,k);for(k=d;k<=e;k++)if(l=a[k],d=q.get(l.key_),void 0!==d){p=b[d];m[d-f]=k;r>d?t=!0:r=d;if(kivi.DEBUG&&!l._canSync(p))throw Error("VNode sync children failed: cannot sync two different children with the same key.");l.sync(p,c)}else this._removeChild(l,c),u++}if(t)for(a=kivi._lis(m),d=a.length-1,k=h-1;0<=k;k--)-1===m[k]?(e=k+f,l=b[e],h=e+1,h=h<b.length?b[h].ref:null,this._insertChild(l,h,c)):0>
d||k!==a[d]?(e=k+f,l=b[e],h=e+1,h=h<b.length?b[h].ref:null,this._moveChild(l,h,c)):d--;else if(n-u!==h)for(k=h-1;0<=k;k--)-1===m[k]&&(e=k+f,l=b[e],h=e+1,h=h<b.length?b[h].ref:null,this._insertChild(l,h,c))}};
kivi._lis=function(a){var b=a.slice(0),c=[];c.push(0);var d,f,e,g,h;d=0;for(f=a.length;d<f;d++)if(-1!==a[d])if(e=c[c.length-1],a[e]<a[d])b[d]=e,c.push(d);else{e=0;for(g=c.length-1;e<g;)h=(e+g)/2|0,a[c[h]]<a[d]?e=h+1:g=h;a[d]<a[c[e]]&&(0<e&&(b[d]=c[e-1]),c[e]=d)}e=c.length;for(g=c[e-1];0<e--;)c[e]=g,g=b[g];return c};var profiler={MAX_SAMPLES:200,instances:{},Widget:function(a){this.name=a;this.samples=[];this.element=document.createElement("div");this.element.style.cssText="padding: 2px; background-color: #020";this.label=document.createElement("div");this.label.style.cssText="text-align: center; font-size: 12px; color: #0f0";this.label.textContent=this.name;this.text=document.createElement("div");this.text.style.cssText="font-size: 12px; color: #0f0";this.canvas=document.createElement("canvas");this.canvas.style.cssText=
"display: block; padding: 0; margin: 0";this.canvas.width=profiler.Widget.WIDTH;this.canvas.height=profiler.Widget.HEIGHT;this.element.appendChild(this.label);this.element.appendChild(this.text);this.element.appendChild(this.canvas);this.ctx=this.canvas.getContext("2d")}};profiler.Widget.HEIGHT=100;profiler.Widget.WIDTH=profiler.MAX_SAMPLES;
profiler.Widget.prototype.update=function(){var a=Math.min.apply(Math,this.samples),b=Math.max.apply(Math,this.samples),c=this.samples[this.samples.length-1],d=profiler.Widget.HEIGHT/b;this.text.innerHTML="<div>min: "+a.toFixed(3)+"ms</div><div>max: "+b.toFixed(3)+"ms</div><div>now: "+c.toFixed(3)+"ms</div>";this.ctx.fillStyle="#010";this.ctx.fillRect(0,0,profiler.Widget.WIDTH,profiler.Widget.HEIGHT);this.ctx.fillStyle="#0f0";for(a=0;a<this.samples.length;a++)this.ctx.fillRect(a,profiler.Widget.HEIGHT,
1,-(this.samples[a]*d))};profiler.init=function(a,b){var c=new profiler.Widget(a);profiler.instances[a]=c;b.appendChild(c.element)};profiler.measure=function(a,b){var c=profiler.instances[a],d=window.performance.now();b();c.samples.push(window.performance.now()-d);c.samples.length>profiler.MAX_SAMPLES&&c.samples.shift();c.update()};kivi.injectComponent=function(a,b,c){a=a.createComponent(null);c.appendChild(a.element);a.attached();a.setData(b);a.update();return a};kivi.mountComponent=function(a,b,c){a=a.mountComponent(null,c);a.attached();a.setData(b);a.update();return a};kivi.nextFrame=function(){return kivi.scheduler.instance.nextFrame()};kivi.currentFrame=function(){return kivi.scheduler.instance.currentFrame()};kivi.scheduleMicrotask=function(a,b){kivi.scheduler.instance.scheduleMicrotask(a,b)};
kivi.scheduleMacrotask=function(a,b){kivi.scheduler.instance.scheduleMacrotask(a,b)};kivi.start=function(a,b){kivi.scheduler.instance.start(a,b)};var app={ui:{}};app.ui.main={};app.R=100;app.C=100;app.mutations=.03;app.randInt=function(a,b){return Math.floor(Math.random()*(b-a+1))+a};app.updateData=function(a,b){for(var c=0;c<a.length;c++)for(var d=a[c],f=0;f<d.length;f++)Math.random()<b&&(d[f]=app.randInt(0,100))};app.ui.main.d=kivi.CDescriptor.create("Main");app.ui.main.d.tag="table";
app.ui.main.d.update=function(a){for(var b=a.data,c=Array(b.length),d=0;d<b.length;d++){for(var f=b[d],e=kivi.VNode.createElement("tr"),g=Array(f.length),h=0;h<f.length;h++){var k=f[h];g[h]=kivi.VNode.createElement("td").classes(50<k?"high":"low").children(k.toString())}c[d]=e.children(g)}a.syncVRoot(kivi.VNode.createRoot().children([kivi.VNode.createElement("tbody").children(c)]))};
document.addEventListener("DOMContentLoaded",function(){function a(){app.updateData(b,app.mutations);profiler.measure("update",function(){app.ui.main.d.update(g)});requestAnimationFrame(a)}profiler.init("update",document.getElementById("perf"));for(var b=[],c=0;c<app.R;c++){for(var d=[],f=0;f<app.C;f++)d.push(app.randInt(0,100));b.push(d)}c=document.createElement("div");c.style.display="flex";d=document.createElement("input");d.type="range";d.style.width="100%";d.style.margin="5px";d.value=100*app.mutations;
var e=document.createElement("label");e.textContent="mutations : "+(100*app.mutations).toFixed(0)+"%";d.addEventListener("change",function(a){app.mutations=a.target.value/100;e.textContent="mutations : "+(100*app.mutations).toFixed(0)+"%"});c.appendChild(e);c.appendChild(d);document.body.insertBefore(c,document.body.firstChild);var g=kivi.injectComponent(app.ui.main.d,b,document.getElementById("app"));requestAnimationFrame(a)});}).call();
