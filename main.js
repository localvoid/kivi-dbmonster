!function t(e,n,r){function i(l,a){if(!n[l]){if(!e[l]){var o="function"==typeof require&&require;if(!a&&o)return o(l,!0);if(s)return s(l,!0);var u=new Error("Cannot find module '"+l+"'");throw u.code="MODULE_NOT_FOUND",u}var f=n[l]={exports:{}};e[l][0].call(f.exports,function(t){var n=e[l][1][t];return i(n?n:t)},f,f.exports,t,e,n,r)}return n[l].exports}for(var s="function"==typeof require&&require,l=0;l<r.length;l++)i(r[l]);return i}({1:[function(t){"use strict";function e(t){for(var e=0;e<t.length;e++)t[e].update()}var n=0,r=100,i=t("kivi"),s=t("kivi/lib/scheduler"),l=t("./data"),a=t("./component/main");document.addEventListener("DOMContentLoaded",function(){i.init(new s);for(var t=[],o=0;r>o;o++)t.push(new l.Database("cluster"+o)),t.push(new l.Database("cluster"+o+"slave"));var u=i.vdom.createComponent(a,{dbs:t});setInterval(function(){e(t),u.invalidate()},n),i.nextFrame().write(function(){i.vdom.injectComponent(u,document.body)})})},{"./component/main":8,"./data":10,kivi:4,"kivi/lib/scheduler":5}],2:[function(t,e){"use strict";function n(t){null==t?(this.dirty=!0,this.rev=-1,this.data=null):(this.dirty=!1,this.rev=i.scheduler.dataClock,this.data=t),this.data=t,this.deps=null,this.subs=null,this.invalidated=null,this.ctx=null}function r(t){if(!t.dirty){t.dirty=!0,null!=t.invalidated&&t.invalidated.call(t.ctx,t);var e=t.subs;if(null!=e)for(var n=0;n<e.length;n++)r(e[n]);t.deps=null,t.subs=null}}var i=t("./env");n.create=function(t){return void 0===t&&(t=null),new n(t)},n.prototype.reset=function(){var t=this.deps;if(null!=t)for(var e=0;e<t.length;e++){var n=t[e].subs;n[n.indexOf(this)]=n[n.length-1],n.pop()}this.deps=null},n.prototype.sub=function(t){null==this.deps&&(this.deps=[]),this.deps.push(t),null==t.subs&&(t.subs=[]),t.subs.push(this)},n.prototype.update=function(t){t&&(this.rev=i.scheduler.dataClock),this.dirty=!1},n.prototype.commit=function(){this.rev=i.scheduler.dataClock;var t=this.subs;if(null!=t)for(var e=0;e<t.length;e++)r(t[e])},e.exports=n},{"./env":3}],3:[function(t,e){"use strict";var n={scheduler:null};e.exports=n},{}],4:[function(t,e){"use strict";function n(t){l.scheduler=t}function r(){return l.scheduler.nextFrame()}function i(t){l.scheduler.scheduleMicrotask(t)}function s(t){l.scheduler.action(t)}var l=t("./env"),a=t("./dnode"),o=t("./vdom");e.exports={ENV:l,DNode:a,vdom:o,init:n,nextFrame:r,scheduleMicrotask:i,action:s}},{"./dnode":2,"./env":3,"./vdom":6}],5:[function(t,e){"use strict";function n(t){this._observer=new window.MutationObserver(t),this._node=document.createTextNode(""),this._observer.observe(this._node,{characterData:!0})}function r(){this.flags=0,this.writeTaskGroups=[],this.writeTasks=null,this.readTasks=null,this.afterTasks=null}function i(){this.flags=0,this.dataClock=0,this.clock=-1,this._actions=null,this._microtasks=null,this._currentFrame=new r,this._nextFrame=new r;var t=this;this._microtaskScheduler=new n(function(){t.flags&=~h,t.flags|=f,t.clock++;var e=t._microtasks;if(null!=e){t._microtasks=null;for(var n=0;n<e.length;n++)e[n]()}t.dataClock++,t.performActions(),t.flags&=~f}),this._handleAnimationFrame=function(){var e,n,r,i,h,d;t.flags&=~c,t.flags|=f,t.clock++,e=t._nextFrame,t._nextFrame=t._currentFrame,t._currentFrame=e;do{for(;0!==(e.flags&u);){if(0!==(e.flags&s))for(e.flags&=~s,n=e.writeTaskGroups,h=0;h<n.length;h++)if(r=n[h],null!=r)for(n[h]=null,d=0;d<r.length;d++)(i=r[d])();if(0!==(e.flags&l))for(e.flags&=~l,r=e.writeTasks,h=0;h<r.length;h++)(i=r[h])()}for(;0!==(e.flags&a);)for(e.flags&=~a,r=e.readTasks,e.readTasks=null,h=0;h<r.length;h++)(i=r[h])()}while(0!==(e.flags&u));for(;0!==(e.flags&o);)for(e.flags&=~o,r=e.afterTasks,h=0;h<r.length;h++)(i=r[h])();t.dataClock++,t.performActions(),t.flags&=~f}}n.prototype.requestNextTick=function(){this._toggle^=1,this._node.data=this._toggle};var s=4,l=8,a=16,o=32,u=l|s;r.prototype.write=function(t,e){var n;if(void 0===e&&(e=-1),-1===e)this.flags|=l,null==this.writeTasks&&(this.writeTasks=[]),this.writeTasks.push(t);else{for(this.flags|=s;e>=this.writeTaskGroups.length;)this.writeTaskGroups.push(null);n=this.writeTaskGroups[e],null==n&&(n=this.writeTaskGroups[e]=[]),n.push(t)}},r.prototype.read=function(t){this.flags|=a,null==this.readTasks&&(this.readTasks=[]),this.readTasks.push(t)},r.prototype.after=function(t){this.flags|=o,null==this.afterTasks&&(this.afterTasks=[]),this.afterTasks.push(t)};var f=1,h=2,c=4;i.prototype.currentFrame=function(){return this._currentFrame},i.prototype.nextFrame=function(){return 0===(this.flags&c)&&(this.flags|=c,window.requestAnimationFrame(this._handleAnimationFrame)),this._nextFrame},i.prototype.scheduleMicrotask=function(t){0===(this.flags&h)&&(this.flags|=h,this._microtaskScheduler.requestNextTick()),null==this._microtasks&&(this._microtasks=[]),this._microtasks.push(t)},i.prototype.action=function(t){0===(this.flags&h)&&(this.flags|=h,this._microtaskScheduler.requestNextTick()),null==this._actions&&(this._actions=[]),this._actions.push(t)},i.prototype.performActions=function(){for(;null!=this._actions;){var t=this._actions;this._actions=null;for(var e=0;e<t.length;e++)t[e]()}},e.exports=i},{}],6:[function(t,e){"use strict";function n(t,e,n,r){this.flags=t,this.key=e,this.tag=n,this.data=r,this.type=null,this.attrs=null,this.style=null,this.classes=null,this.children=null,this.ref=null,this.cref=null}function r(t){return new n(S,null,null,t)}function i(t,e){return new n(S,t,null,e)}function s(t){return new n(G,null,t,null)}function l(t,e){return new n(G,t,e,null)}function a(t,e){return void 0===e&&(e=null),new n(V,null,t,e)}function o(t,e,r){return void 0===r&&(r=null),new n(G,t,e,r)}function u(t){return new n(G|U,null,t,null)}function f(t,e){return new n(G|U,t,e,null)}function h(t,e){return void 0===e&&(e=null),new n($,null,t,e)}function c(t,e,r){return void 0===r&&(r=null),new n($,t,e,r)}function d(){return new n(Q,null,null,null)}function p(t,e){return t.flags===e.flags&&t.tag===e.tag}function v(t,e){var n=t.flags;if(0!==(n&S))t.ref=document.createTextNode(t.data);else if(0!==(n&G))t.ref=0===(n&U)?document.createElement(t.tag):document.createElementNS("http://www.w3.org/2000/svg",t.tag);else if(0!==(n&V))t.ref=M(t.tag,t.data);else if(0!==(n&$)){var r=D(t.tag,t.data,e);t.ref=r.element,t.cref=r}}function g(t,e){var n,r,i,s=t.flags;if(0!==(s&(G|V|$|Q))){var l=t.ref,a=t.type,o=t.attrs,u=t.style,f=t.classes,h=t.children;if(null!=a&&l.classList.add(a),null!=o)for(i in o)l.setAttribute(i,o[i]);if(null!=u){var c=l.style;for(i in u)c.setProperty(i,u[i])}if(null!=f){var d=l.classList;for(n=0,r=f.length;r>n;n++)d.add(f[n])}if(null!=h)for(n=0,r=h.length;r>n;n++)b(t,h[n],null,e);0!==(s&$)&&t.cref.update()}}function m(t,e,n){var r=t.ref,i=t.flags;if(e.ref=r,0!==(i&S))t.data!=e.data&&(t.ref.nodeValue=e.data);else if(0!==(i&(G|V|$|Q)))if(t.attrs!==e.attrs&&y(t.attrs,e.attrs,r),t.style!==e.style&&k(t.style,e.style,r.style),t.classes!==e.classes&&w(t.classes,e.classes,r.classList),t.children!==e.children&&x(t,t.children,e.children,n),0!==(i&V)){var s=e.tag;0!==(s.flags&B)&&s.update.call(r,t.data,e.data)}else if(0!==(i&$)){{var l=e.cref=t.cref;l.state}l.updateProps(e.data),l.update()}}function y(t,e,n){var r,i,s;if(null!=t)if(null==e)for(r in t)n.removeAttribute(r);else{for(r in t)s=e[r],void 0===s?n.removeAttribute(r):(i=t[r],i!==s&&n.setAttribute(r,s));for(r in e)i=t[r],void 0===i&&n.setAttribute(r,e[r])}else if(null!=e)for(r in e)n.setAttribute(r,e[r])}function k(t,e,n){var r,i;if(null!=t)if(null==e)for(r in t)n.removeProperty(r);else{for(r in t)i=e[r],void 0===i?n.removeProperty(r):n.setProperty(r,i);for(r in e)i=t[r],void 0===i&&n.setProperty(r,e[r])}else if(null!=e)for(r in e)n.setProperty(r,e[r])}function w(t,e,n){var r,i,s,l,a,o,u,f;if(null!=t&&t.length>0)if(null==e||0===e.length)for(r=0;r<t.length;r++)n.remove(t[r]);else if(t.length*e.length<=16){for(o=new Array(e.length),r=0;r<t.length;r++){for(l=t[r],u=!0,i=0;i<e.length;i++)if(a=e[i],l===a){u=!1,o[i]=!0;break}u&&n.remove(l)}for(r=0;r<e.length;r++)1!=o[r]&&n.add(e[r])}else{for(f={},r=0;r<e.length;r++)a=e[r],f[a]=!1;for(r=0;r<t.length;r++)l=t[r],void 0===f[l]?n.remove(l):f[l]=!0;for(s in f)f[s]===!1&&n.add(s)}else if(null!=e&&e.length>0)for(r=0;r<e.length;r++)n.add(e[r])}function b(t,e,n,r){0===(t.flags&$)||0===(t.cref.flags&ee)?(v(e,r),t.ref.insertBefore(e.ref,n),g(e,r)):t.cref.descriptor.insert.call(t.cref,e,n,r)}function _(t,e,n,r){0===(t.flags&$)||0===(t.cref.flags&ne)?t.ref.insertBefore(e.ref,n):t.cref.descriptor.move.call(t.cref,e,n,r)}function T(t,e,n){0===(t.flags&$)||0===(t.cref.flags&re)?t.ref.removeChild(e.ref):t.cref.descriptor.remove.call(t.cref,e,n)}function x(t,e,n,r){var i,s,l,a;if(null!=e&&0!==e.length)if(null==n||0===n.length)for(l=0;l<e.length;l++)T(t,e[l],r);else if(1===e.length&&1===n.length)i=e[0],s=n[0],null==i.key&&p(i,s)||null!=i.key&&i.key===s.key?m(i,s,r):(T(t,i,r),b(t,s,null,r));else if(1===e.length)if(i=e[0],null==i.key)F(t,e,n,r);else{for(a=-1,l=0;l<n.length;l++){if(s=n[l],i.key===s.key){a=l;break}b(t,s,i.ref,r)}if(-1!==a){for(l=a+1;l<n.length;l++)b(t,n[l],null,r);m(i,n[a],r)}else T(t,i,r)}else if(1===n.length)if(s=n[0],null==s.key)F(t,e,n,r);else{for(a=-1,l=0;l<e.length;l++){if(i=e[l],i.key===s.key){a=l;break}T(t,i,r)}if(-1!==a){for(l=a+1;l<e.length;l++)T(t,e[l],r);m(e[a],s,r)}else b(t,s,null,r)}else null==e[0].key?F(t,e,n,r):C(t,e,n,r);else if(null!=n&&n.length>0)for(l=0;l<n.length;l++)b(t,n[l],null,r)}function F(t,e,n,r){for(var i,s,l,a,o=0,u=0,f=e.length-1,h=n.length-1;f>=o&&h>=u&&(i=e[o],s=n[u],p(i,s));)o++,u++,m(i,s,r);for(;f>=o&&h>=u&&(i=e[f],s=n[h],p(i,s));)f--,h--,m(i,s,r);for(;f>=o&&h>=u;)i=e[o++],s=n[u++],p(i,s)?m(i,s,r):(b(t,s,i.ref,r),T(t,i,r));for(;f>=o;)T(t,e[o++],r);for(l=h+1,a=l<n.length?n[l].ref:null;h>=u;)b(t,n[u++],a,r)}function C(t,e,n,r){var i,s,l,a,o,u,f,h,c,d=0,p=0,v=e.length-1,g=n.length-1,y=e[d],k=n[p],w=e[v],x=n[g],F=!1;t:do{for(F=!0;y.key===k.key;){if(m(y,k,r),d++,p++,d>v||p>g)break t;y=e[d],k=n[p],F=!1}for(;w.key===x.key;){if(m(w,x,r),v--,g--,d>v||p>g)break t;w=e[v],x=n[g],F=!1}for(;y.key===x.key;){if(m(y,x,r),l=g+1,a=l<n.length?n[l].ref:null,_(t,x,a,r),d++,g--,d>v||p>g)break t;y=e[d],x=n[g],F=!1;continue t}for(;w.key===k.key;){if(m(w,k,r),_(t,k,y.ref,r),v--,p++,d>v||p>g)break t;w=e[v],k=n[p],F=!1}}while(!F&&v>=d&&g>=p);if(d>v)for(l=g+1,a=l<n.length?n[l].ref:null;g>=p;)b(t,n[p++],a,r);else if(p>g)for(;v>=d;)T(t,e[d++],r);else{var C=v-d+1,A=g-p+1,M=new Array(A);for(i=0;A>i;i++)M[i]=-1;var q=!1,N=0;if(16>=C*A)for(i=d;v>=i;i++){var D=!0;for(o=e[i],s=p;g>=s;s++)if(u=n[s],o.key===u.key){M[s-p]=i,f>s?q=!0:f=s,m(o,u,r),D=!1;break}D&&(T(t,o,r),N++)}else{var O={};for(i=p;g>=i;i++)c=n[i],O[c.key]=i;for(i=d;v>=i;i++)o=e[i],s=O[o.key],null!=s?(u=n[s],M[s-p]=i,f>s?q=!0:f=s,m(o,u,r)):(T(t,o,r),N++)}if(q){var P=E(M);for(s=P.length-1,i=A-1;i>=0;i--)-1===M[i]?(h=i+p,c=n[h],l=h+1,a=l<n.length?n[l].ref:null,b(t,c,a,r)):0>s||i!=P[s]?(h=i+p,c=n[h],l=h+1,a=l<n.length?n[l].ref:null,_(t,c,a,r)):s--}else if(C-N!=A)for(i=A-1;i>=0;i--)-1===M[i]&&(h=i+p,c=n[h],l=h+1,a=l<n.length?n[l].ref:null,b(t,c,a,r))}}function E(t){var e,n,r,i,s,l,a=t.slice(0),o=[0];for(e=0,n=t.length;n>e;e++)if(-1!==t[e])if(r=o[o.length-1],t[r]<t[e])a[e]=r,o.push(e);else{for(i=0,s=o.length-1;s>i;)l=(i+s)/2|0,t[o[l]]<t[e]?i=l+1:s=l;t[e]<t[o[i]]&&(i>0&&(a[e]=o[i-1]),o[i]=e)}for(i=o.length,s=o[i-1];i-->0;)o[i]=s,s=a[s];return o}function A(t){var e=0,n=t.tag,r=t.init,i=t.update;return void 0===n&&(n="div"),void 0===r?r=null:e|=j,void 0===i?i=null:e|=B,{flags:e,tag:n,init:r,update:i}}function M(t,e){var n=document.createElement(t.tag);return 0!==(t.flags&j)&&t.init.call(n,e),n}function q(t,e,n){var r=t.flags;this.flags=r|I,this.descriptor=t,this.depth=null==e?0:e.depth+1,this.parent=e,this.props=n,0===(r&z)?this.state=null:(this.state=P.create(),this.state.invalidated=this.invalidate,this.state.ctx=this),this.rev=-1,this.root=null,this.element=document.createElement(t.tag),this._update=null,0!==(r&H)&&t.init.call(this)}function N(t){var e=0,n=t.tag,r=t.updateProps,i=t.updateState,s=t.init,l=t.build,a=t.attached,o=t.detached,u=t.domAttached,f=t.domDetached,h=t.update,c=t.insert,d=t.move,p=t.remove;return void 0===n&&(n="div"),void 0===r?r=null:e|=X,void 0===i?i=null:e|=R|z,void 0===s?s=null:e|=H,void 0===l?l=null:e|=J,void 0===a?a=null:e|=K,void 0===o?o=null:e|=W,void 0===u?u=null:e|=Y,void 0===f?f=null:e|=Z,void 0===h?h=null:e|=te,void 0===c?c=null:e|=ee,void 0===d?d=null:e|=ne,void 0===p?p=null:e|=re,{flags:e,updateProps:r,updateState:i,init:s,build:l,attached:a,detached:o,domAttached:u,domDetached:f,update:h,insert:c,move:d,remove:p,tag:n}}function D(t,e,n){return new q(t,n,e)}function O(t,e){e.appendChild(t.element),t.attach(),t.domAttach(),t.update()}var P=t("./dnode"),L=t("./env"),S=1,G=2,V=4,$=8,Q=16,U=64;n.TEXT=S,n.ELEMENT=G,n.CUSTOM_ELEMENT=V,n.COMPONENT=$,n.ROOT=Q;var j=4,B=8,I=1,R=2,X=128,z=256,H=512,J=1024,K=2048,W=4096,Y=8192,Z=16384,te=65536,ee=262144,ne=524288,re=1048576;q.prototype.domAttach=function(){},q.prototype.domDetach=function(){},q.prototype.attach=function(){},q.prototype.detach=function(){},q.prototype.updateProps=function(t){0!==(this.flags&X)?this.descriptor.updateProps.call(this,t)&&(this.flags|=I):(this.props=t,this.flags|=I)},q.prototype.update=function(){var t=this.flags;if(0!==(t&I)){var e=this.descriptor;0===(t&te)?(0!==(t&z)?(e.updateState.call(this),this.rev<this.state.rev&&this.updateView(e.build.call(this))):this.updateView(e.build.call(this)),this.flags&=~I):e.update.call(this),this.rev=L.scheduler.clock}},q.prototype.updateView=function(t){var e=this.root;null==e?(t.ref=this.element,t.cref=this,g(t,this)):m(e,t,this),this.root=t},q.prototype.invalidate=function(){0===(this.flags&I)&&(this.flags|=I,null==this._update&&(this._update=this.update.bind(this)),L.scheduler.nextFrame().write(this._update,this.depth))},q.prototype.dispose=function(){0!==(this.flags&R)&&this.state.dispose()},e.exports={VNode:n,Component:q,declareElement:A,declareComponent:N,create:v,render:g,update:m,createComponent:D,t:r,$t:i,e:s,$e:l,d:a,$d:o,s:u,$s:f,c:h,$c:c,r:d,injectComponent:O}},{"./dnode":2,"./env":3}],7:[function(t,e){"use strict";function n(t){if(!t)return"";var e=parseFloat(t).toFixed(2);if(t>60){var n=Math.floor(t/60),r=(value%60).toFixed(2).split("."),i=r[0].lpad("0",2),s=r[1];e=n+":"+i+"."+s}return e}var r=t("kivi"),i=r.vdom,s=t("./popover"),l=["label-important"],a=["label-warning"],o=["label-success"],u=i.declareComponent({tag:"tr",build:function(){var t=this.props.db,e=t.getTopFiveQueries(),r=i.e("td");r.type="dbname",r.children=[i.t(t.name)];var u=t.queries.length,f=i.e("span");f.type="label",f.children=[i.t(u)],f.classes=u>=20?l:u>=10?a:o;var h=i.e("td");h.type="query-count",h.children=[f];for(var c=[r,h],d=0;5>d;d++){var p=e[d],v=p.elapsed,g=i.t(n(v)),m=i.c(s,{query:p.query}),y=i.e("td");y.type="Query";var k=[];k.push("elapsed"),k.push(v>=10?"warn_long":v>=1?"warn":"short"),y.classes=k,y.children=[g,m],c.push(y)}var w=i.r();return w.children=c,w}});e.exports=u},{"./popover":9,kivi:4}],8:[function(t,e){"use strict";var n=t("kivi"),r=n.vdom,i=t("./entry"),s=["table","table-striped","latest-data"],l=r.declareComponent({tag:"table",build:function(){for(var t=this.props.dbs,e=[],n=0;n<t.length;n++){var l=t[n];e.push(r.$c(l.id,i,{db:l}))}var a=r.e("tbody");a.children=e;var o=r.r();return o.classes=s,o.children=[a],o}});e.exports=l},{"./entry":7,kivi:4}],9:[function(t,e){"use strict";var n=t("kivi"),r=n.vdom,i=["popover","left"],s=r.declareComponent({build:function(){var t=r.e("div");t.type="popover-content",t.children=[r.t(this.props.query)];var e=r.e("div");e.type="arrow";var n=r.r();return n.classes=i,n.children=[t,e],n}});e.exports=s},{kivi:4}],10:[function(t,e){"use strict";function n(t,e,n){this.elapsed=t,this.waiting=e,this.query=n}function r(t){this.id=i++,this.name=t,this.queries=null,this.update()}n.rand=function(){var t=15*Math.random(),e=Math.random()<.5,r="SELECT blah FROM something";return Math.random()<.2&&(r="<IDLE> in transaction"),Math.random()<.1&&(r="vacuum"),new n(t,e,r)};var i=0;r.prototype.update=function(){for(var t=[],e=Math.floor(10*Math.random()+1),r=0;e>r;r++)t.push(n.rand());this.queries=t},r.prototype.getTopFiveQueries=function(){var t=this.queries.slice();for(t.sort(function(t,e){return t.elapsed-e.elapsed}),t=t.slice(0,5);t.length<5;)t.push(new n(0,!1,""));return t},e.exports={Query:n,Database:r}},{}]},{},[1]);
//# sourceMappingURL=main.js.map