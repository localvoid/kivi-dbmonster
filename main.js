!function t(e,r,n){function i(l,a){if(!r[l]){if(!e[l]){var o="function"==typeof require&&require;if(!a&&o)return o(l,!0);if(s)return s(l,!0);var u=new Error("Cannot find module '"+l+"'");throw u.code="MODULE_NOT_FOUND",u}var f=r[l]={exports:{}};e[l][0].call(f.exports,function(t){var r=e[l][1][t];return i(r?r:t)},f,f.exports,t,e,r,n)}return r[l].exports}for(var s="function"==typeof require&&require,l=0;l<n.length;l++)i(n[l]);return i}({1:[function(t){"use strict";var e=0,r=100,n=t("kivi"),i=t("kivi/lib/scheduler"),s=t("./app"),l=t("./store"),a=t("./cache"),o=t("./component/main");document.addEventListener("DOMContentLoaded",function(){n.init(new i),s.store=new l(r),s.cache=new a,setInterval(function(){n.action(function(){s.store.update()})},e),n.nextFrame().write(function(){n.vdom.injectComponent(n.vdom.createComponent(o),document.body)})})},{"./app":7,"./cache":8,"./component/main":10,"./store":12,kivi:4,"kivi/lib/scheduler":5}],2:[function(t,e){"use strict";function r(t){null==t?(this.dirty=!0,this.rev=-1,this.data=null):(this.dirty=!1,this.rev=i.scheduler.dataClock,this.data=t),this.data=t,this.deps=null,this.subs=null,this.invalidated=null,this.ctx=null}function n(t){if(!t.dirty){t.dirty=!0,null!=t.invalidated&&t.invalidated.call(t.ctx,t);var e=t.subs;if(null!=e)for(var r=0;r<e.length;r++)n(e[r]);t.deps=null,t.subs=null}}var i=t("./env");r.create=function(t){return void 0===t&&(t=null),new r(t)},r.prototype.reset=function(){var t=this.deps;if(null!=t)for(var e=0;e<t.length;e++){var r=t[e].subs;r[r.indexOf(this)]=r[r.length-1],r.pop()}this.deps=null},r.prototype.sub=function(t){null==this.deps&&(this.deps=[]),this.deps.push(t),null==t.subs&&(t.subs=[]),t.subs.push(this)},r.prototype.update=function(t){t&&(this.rev=i.scheduler.dataClock),this.dirty=!1},r.prototype.commit=function(){this.rev=i.scheduler.dataClock;var t=this.subs;if(null!=t)for(var e=0;e<t.length;e++)n(t[e])},e.exports=r},{"./env":3}],3:[function(t,e){"use strict";var r={scheduler:null};e.exports=r},{}],4:[function(t,e){"use strict";function r(t){l.scheduler=t}function n(){return l.scheduler.nextFrame()}function i(t){l.scheduler.scheduleMicrotask(t)}function s(t){l.scheduler.action(t)}var l=t("./env"),a=t("./dnode"),o=t("./vdom");e.exports={ENV:l,DNode:a,vdom:o,init:r,nextFrame:n,scheduleMicrotask:i,action:s}},{"./dnode":2,"./env":3,"./vdom":6}],5:[function(t,e){"use strict";function r(t){this._observer=new window.MutationObserver(t),this._node=document.createTextNode(""),this._observer.observe(this._node,{characterData:!0})}function n(){this.flags=0,this.writeTaskGroups=[],this.writeTasks=null,this.readTasks=null,this.afterTasks=null}function i(){this.flags=0,this.dataClock=0,this.clock=-1,this._actions=null,this._microtasks=null,this._currentFrame=new n,this._nextFrame=new n;var t=this;this._microtaskScheduler=new r(function(){t.flags&=~c,t.flags|=f,t.clock++;var e=t._microtasks;if(null!=e){t._microtasks=null;for(var r=0;r<e.length;r++)e[r]()}t.dataClock++,t.performActions(),t.flags&=~f}),this._handleAnimationFrame=function(){var e,r,n,i,c,d;t.flags&=~h,t.flags|=f,t.clock++,e=t._nextFrame,t._nextFrame=t._currentFrame,t._currentFrame=e;do{for(;0!==(e.flags&u);){if(0!==(e.flags&s))for(e.flags&=~s,r=e.writeTaskGroups,c=0;c<r.length;c++)if(n=r[c],null!=n)for(r[c]=null,d=0;d<n.length;d++)(i=n[d])();if(0!==(e.flags&l))for(e.flags&=~l,n=e.writeTasks,c=0;c<n.length;c++)(i=n[c])()}for(;0!==(e.flags&a);)for(e.flags&=~a,n=e.readTasks,e.readTasks=null,c=0;c<n.length;c++)(i=n[c])()}while(0!==(e.flags&u));for(;0!==(e.flags&o);)for(e.flags&=~o,n=e.afterTasks,c=0;c<n.length;c++)(i=n[c])();t.dataClock++,t.performActions(),t.flags&=~f}}r.prototype.requestNextTick=function(){this._toggle^=1,this._node.data=this._toggle};var s=4,l=8,a=16,o=32,u=l|s;n.prototype.write=function(t,e){var r;if(void 0===e&&(e=-1),-1===e)this.flags|=l,null==this.writeTasks&&(this.writeTasks=[]),this.writeTasks.push(t);else{for(this.flags|=s;e>=this.writeTaskGroups.length;)this.writeTaskGroups.push(null);r=this.writeTaskGroups[e],null==r&&(r=this.writeTaskGroups[e]=[]),r.push(t)}},n.prototype.read=function(t){this.flags|=a,null==this.readTasks&&(this.readTasks=[]),this.readTasks.push(t)},n.prototype.after=function(t){this.flags|=o,null==this.afterTasks&&(this.afterTasks=[]),this.afterTasks.push(t)};var f=1,c=2,h=4;i.prototype.currentFrame=function(){return this._currentFrame},i.prototype.nextFrame=function(){return 0===(this.flags&h)&&(this.flags|=h,window.requestAnimationFrame(this._handleAnimationFrame)),this._nextFrame},i.prototype.scheduleMicrotask=function(t){0===(this.flags&c)&&(this.flags|=c,this._microtaskScheduler.requestNextTick()),null==this._microtasks&&(this._microtasks=[]),this._microtasks.push(t)},i.prototype.action=function(t){0===(this.flags&c)&&(this.flags|=c,this._microtaskScheduler.requestNextTick()),null==this._actions&&(this._actions=[]),this._actions.push(t)},i.prototype.performActions=function(){for(;null!=this._actions;){var t=this._actions;this._actions=null;for(var e=0;e<t.length;e++)t[e]()}},e.exports=i},{}],6:[function(t,e){"use strict";function r(t,e,r,n){this.flags=t,this.key=e,this.tag=r,this.data=n,this.type=null,this.attrs=null,this.style=null,this.classes=null,this.children=null,this.ref=null,this.cref=null}function n(t){return new r(L,null,null,t)}function i(t,e){return new r(L,t,null,e)}function s(t){return new r(G,null,t,null)}function l(t,e){return new r(G,t,e,null)}function a(t,e){return void 0===e&&(e=null),new r(V,null,t,e)}function o(t,e,n){return void 0===n&&(n=null),new r(G,t,e,n)}function u(t){return new r(G|U,null,t,null)}function f(t,e){return new r(G|U,t,e,null)}function c(t,e){return void 0===e&&(e=null),new r($,null,t,e)}function h(t,e,n){return void 0===n&&(n=null),new r($,t,e,n)}function d(){return new r(Q,null,null,null)}function p(t,e){return t.flags===e.flags&&t.tag===e.tag}function v(t,e){var r=t.flags;if(0!==(r&L))t.ref=document.createTextNode(t.data);else if(0!==(r&G))t.ref=0===(r&U)?document.createElement(t.tag):document.createElementNS("http://www.w3.org/2000/svg",t.tag);else if(0!==(r&V))t.ref=E(t.tag,t.data);else if(0!==(r&$)){var n=O(t.tag,t.data,e);t.ref=n.element,t.cref=n}}function g(t,e){var r,n,i,s=t.flags;if(0!==(s&(G|V|$|Q))){var l=t.ref,a=t.type,o=t.attrs,u=t.style,f=t.classes,c=t.children;if(null!=a&&l.classList.add(a),null!=o)for(i in o)l.setAttribute(i,o[i]);if(null!=u){var h=l.style;for(i in u)h.setProperty(i,u[i])}if(null!=f){var d=l.classList;for(r=0,n=f.length;n>r;r++)d.add(f[r])}if(null!=c)for(r=0,n=c.length;n>r;r++)w(t,c[r],null,e);0!==(s&$)&&t.cref.update()}}function m(t,e,r){var n=t.ref,i=t.flags;if(e.ref=n,0!==(i&L))t.data!=e.data&&(t.ref.nodeValue=e.data);else if(0!==(i&(G|V|$|Q)))if(t.attrs!==e.attrs&&y(t.attrs,e.attrs,n),t.style!==e.style&&k(t.style,e.style,n.style),t.classes!==e.classes&&b(t.classes,e.classes,n.classList),t.children!==e.children&&x(t,t.children,e.children,r),0!==(i&V)){var s=e.tag;0!==(s.flags&B)&&s.update.call(n,t.data,e.data)}else if(0!==(i&$)){{var l=e.cref=t.cref;l.state}l.updateProps(e.data),l.update()}}function y(t,e,r){var n,i,s;if(null!=t)if(null==e)for(n in t)r.removeAttribute(n);else{for(n in t)s=e[n],void 0===s?r.removeAttribute(n):(i=t[n],i!==s&&r.setAttribute(n,s));for(n in e)i=t[n],void 0===i&&r.setAttribute(n,e[n])}else if(null!=e)for(n in e)r.setAttribute(n,e[n])}function k(t,e,r){var n,i;if(null!=t)if(null==e)for(n in t)r.removeProperty(n);else{for(n in t)i=e[n],void 0===i?r.removeProperty(n):r.setProperty(n,i);for(n in e)i=t[n],void 0===i&&r.setProperty(n,e[n])}else if(null!=e)for(n in e)r.setProperty(n,e[n])}function b(t,e,r){var n,i,s,l,a,o,u,f;if(null!=t&&t.length>0)if(null==e||0===e.length)for(n=0;n<t.length;n++)r.remove(t[n]);else if(t.length*e.length<=16){for(o=new Array(e.length),n=0;n<t.length;n++){for(l=t[n],u=!0,i=0;i<e.length;i++)if(a=e[i],l===a){u=!1,o[i]=!0;break}u&&r.remove(l)}for(n=0;n<e.length;n++)1!=o[n]&&r.add(e[n])}else{for(f={},n=0;n<e.length;n++)a=e[n],f[a]=!1;for(n=0;n<t.length;n++)l=t[n],void 0===f[l]?r.remove(l):f[l]=!0;for(s in f)f[s]===!1&&r.add(s)}else if(null!=e&&e.length>0)for(n=0;n<e.length;n++)r.add(e[n])}function w(t,e,r,n){0===(t.flags&$)||0===(t.cref.flags&ee)?(v(e,n),t.ref.insertBefore(e.ref,r),g(e,n)):t.cref.descriptor.insert.call(t.cref,e,r,n)}function _(t,e,r,n){0===(t.flags&$)||0===(t.cref.flags&re)?t.ref.insertBefore(e.ref,r):t.cref.descriptor.move.call(t.cref,e,r,n)}function T(t,e,r){0===(t.flags&$)||0===(t.cref.flags&ne)?t.ref.removeChild(e.ref):t.cref.descriptor.remove.call(t.cref,e,r)}function x(t,e,r,n){var i,s,l,a;if(null!=e&&0!==e.length)if(null==r||0===r.length)for(l=0;l<e.length;l++)T(t,e[l],n);else if(1===e.length&&1===r.length)i=e[0],s=r[0],null==i.key&&p(i,s)||null!=i.key&&i.key===s.key?m(i,s,n):(T(t,i,n),w(t,s,null,n));else if(1===e.length)if(i=e[0],null==i.key)F(t,e,r,n);else{for(a=-1,l=0;l<r.length;l++){if(s=r[l],i.key===s.key){a=l;break}w(t,s,i.ref,n)}if(-1!==a){for(l=a+1;l<r.length;l++)w(t,r[l],null,n);m(i,r[a],n)}else T(t,i,n)}else if(1===r.length)if(s=r[0],null==s.key)F(t,e,r,n);else{for(a=-1,l=0;l<e.length;l++){if(i=e[l],i.key===s.key){a=l;break}T(t,i,n)}if(-1!==a){for(l=a+1;l<e.length;l++)T(t,e[l],n);m(e[a],s,n)}else w(t,s,null,n)}else null==e[0].key?F(t,e,r,n):q(t,e,r,n);else if(null!=r&&r.length>0)for(l=0;l<r.length;l++)w(t,r[l],null,n)}function F(t,e,r,n){for(var i,s,l,a,o=0,u=0,f=e.length-1,c=r.length-1;f>=o&&c>=u&&(i=e[o],s=r[u],p(i,s));)o++,u++,m(i,s,n);for(;f>=o&&c>=u&&(i=e[f],s=r[c],p(i,s));)f--,c--,m(i,s,n);for(;f>=o&&c>=u;)i=e[o++],s=r[u++],p(i,s)?m(i,s,n):(w(t,s,i.ref,n),T(t,i,n));for(;f>=o;)T(t,e[o++],n);for(l=c+1,a=l<r.length?r[l].ref:null;c>=u;)w(t,r[u++],a,n)}function q(t,e,r,n){var i,s,l,a,o,u,f,c,h,d=0,p=0,v=e.length-1,g=r.length-1,y=e[d],k=r[p],b=e[v],x=r[g],F=!1;t:do{for(F=!0;y.key===k.key;){if(m(y,k,n),d++,p++,d>v||p>g)break t;y=e[d],k=r[p],F=!1}for(;b.key===x.key;){if(m(b,x,n),v--,g--,d>v||p>g)break t;b=e[v],x=r[g],F=!1}for(;y.key===x.key;){if(m(y,x,n),l=g+1,a=l<r.length?r[l].ref:null,_(t,x,a,n),d++,g--,d>v||p>g)break t;y=e[d],x=r[g],F=!1}for(;b.key===k.key;){if(m(b,k,n),_(t,b,e[d].ref,n),v--,p++,d>v||p>g)break t;b=e[v],k=r[p],F=!1}}while(!F&&v>=d&&g>=p);if(d>v)for(l=g+1,a=l<r.length?r[l].ref:null;g>=p;)w(t,r[p++],a,n);else if(p>g)for(;v>=d;)T(t,e[d++],n);else{var q=v-d+1,A=g-p+1,E=new Array(A);for(i=0;A>i;i++)E[i]=-1;var M=!1,N=0;if(16>=q*A)for(i=d;v>=i;i++){var O=!0;for(o=e[i],s=p;g>=s;s++)if(u=r[s],o.key===u.key){E[s-p]=i,f>s?M=!0:f=s,m(o,u,n),O=!1;break}O&&(T(t,o,n),N++)}else{var P={};for(i=p;g>=i;i++)h=r[i],P[h.key]=i;for(i=d;v>=i;i++)o=e[i],s=P[o.key],null!=s?(u=r[s],E[s-p]=i,f>s?M=!0:f=s,m(o,u,n)):(T(t,o,n),N++)}if(M){var D=C(E);for(s=D.length-1,i=A-1;i>=0;i--)-1===E[i]?(c=i+p,h=r[c],l=c+1,a=l<r.length?r[l].ref:null,w(t,h,a,n)):0>s||i!=D[s]?(c=i+p,h=e[E[i]],l=c+1,a=l<r.length?r[l].ref:null,_(t,h,a,n)):s--}else if(q-N!=A)for(i=A-1;i>=0;i--)-1===E[i]&&(c=i+p,h=r[c],l=c+1,a=l<r.length?r[l].ref:null,w(t,h,a,n))}}function C(t){var e,r,n,i,s,l,a=t.slice(0),o=[0];for(e=0,r=t.length;r>e;e++)if(-1!==t[e])if(n=o[o.length-1],t[n]<t[e])a[e]=n,o.push(e);else{for(i=0,s=o.length-1;s>i;)l=(i+s)/2|0,t[o[l]]<t[e]?i=l+1:s=l;t[e]<t[o[i]]&&(i>0&&(a[e]=o[i-1]),o[i]=e)}for(i=o.length,s=o[i-1];i-->0;)o[i]=s,s=a[s];return o}function A(t){var e=0,r=t.tag,n=t.init,i=t.update;return void 0===r&&(r="div"),void 0===n?n=null:e|=j,void 0===i?i=null:e|=B,{flags:e,tag:r,init:n,update:i}}function E(t,e){var r=document.createElement(t.tag);return 0!==(t.flags&j)&&t.init.call(r,e),r}function M(t,e,r){var n=t.flags;this.flags=n|I,this.descriptor=t,this.depth=null==e?0:e.depth+1,this.parent=e,this.props=r,0===(n&z)?this.state=null:(this.state=D.create(),this.state.invalidated=this.invalidate,this.state.ctx=this),this.rev=-1,this.root=null,this.element=document.createElement(t.tag),this._update=null,0!==(n&H)&&t.init.call(this)}function N(t){var e=0,r=t.tag,n=t.updateProps,i=t.updateState,s=t.init,l=t.build,a=t.attached,o=t.detached,u=t.domAttached,f=t.domDetached,c=t.update,h=t.insert,d=t.move,p=t.remove;return void 0===r&&(r="div"),void 0===n?n=null:e|=X,void 0===i?i=null:e|=R|z,void 0===s?s=null:e|=H,void 0===l?l=null:e|=J,void 0===a?a=null:e|=K,void 0===o?o=null:e|=W,void 0===u?u=null:e|=Y,void 0===f?f=null:e|=Z,void 0===c?c=null:e|=te,void 0===h?h=null:e|=ee,void 0===d?d=null:e|=re,void 0===p?p=null:e|=ne,{flags:e,updateProps:n,updateState:i,init:s,build:l,attached:a,detached:o,domAttached:u,domDetached:f,update:c,insert:h,move:d,remove:p,tag:r}}function O(t,e,r){return new M(t,r,e)}function P(t,e){e.appendChild(t.element),t.attach(),t.domAttach(),t.update()}var D=t("./dnode"),S=t("./env"),L=1,G=2,V=4,$=8,Q=16,U=64;r.TEXT=L,r.ELEMENT=G,r.CUSTOM_ELEMENT=V,r.COMPONENT=$,r.ROOT=Q;var j=4,B=8,I=1,R=2,X=128,z=256,H=512,J=1024,K=2048,W=4096,Y=8192,Z=16384,te=65536,ee=262144,re=524288,ne=1048576;M.prototype.domAttach=function(){},M.prototype.domDetach=function(){},M.prototype.attach=function(){},M.prototype.detach=function(){},M.prototype.updateProps=function(t){0!==(this.flags&X)?this.descriptor.updateProps.call(this,t)&&(this.flags|=I):(this.props=t,this.flags|=I)},M.prototype.update=function(){var t=this.flags;if(0!==(t&I)){var e=this.descriptor;0===(t&te)?(0!==(t&z)?(e.updateState.call(this),this.rev<this.state.rev&&this.updateView(e.build.call(this))):this.updateView(e.build.call(this)),this.flags&=~I):e.update.call(this),this.rev=S.scheduler.clock}},M.prototype.updateView=function(t){var e=this.root;null==e?(t.ref=this.element,t.cref=this,g(t,this)):m(e,t,this),this.root=t},M.prototype.invalidate=function(){0===(this.flags&I)&&(this.flags|=I,null==this._update&&(this._update=this.update.bind(this)),S.scheduler.nextFrame().write(this._update,this.depth))},M.prototype.dispose=function(){0!==(this.flags&R)&&this.state.dispose()},e.exports={VNode:r,Component:M,declareElement:A,declareComponent:N,create:v,render:g,update:m,createComponent:O,t:n,$t:i,e:s,$e:l,d:a,$d:o,s:u,$s:f,c:c,$c:h,r:d,injectComponent:P}},{"./dnode":2,"./env":3}],7:[function(t,e){"use strict";var r={store:null,cache:null};e.exports=r},{}],8:[function(t,e){"use strict";var r=t("kivi"),n=r.DNode,i=t("./app"),s=function(){this._queries={}};s.prototype.getTopFiveQueries=function(t){var e=this._queries[t];if(void 0===e&&(e=n.create(),this._queries[t]=e),e.dirty){var r=i.store.get(t);e.sub(r);var s=r.data.queries.slice();for(s.sort(function(t,e){return t.elapsed-e.elapsed}),s=s.slice(0,5);s.length<5;)s.push({elapsed:0,query:"",waiting:0});e.data=s,e.update(!0)}return e},e.exports=s},{"./app":7,kivi:4}],9:[function(t,e){"use strict";function r(t){if(!t)return"";var e=parseFloat(t).toFixed(2);if(t>60){var r=Math.floor(t/60),n=(value%60).toFixed(2).split("."),i=n[0].lpad("0",2),s=n[1];e=r+":"+i+"."+s}return e}var n=t("kivi"),i=n.vdom,s=t("../app"),l=t("./popover"),a=["label-important"],o=["label-warning"],u=["label-success"],f=i.declareComponent({tag:"tr",updateState:function(){var t=s.cache.getTopFiveQueries(this.props.db.data.id);this.state.sub(t),this.state.data={topFiveQueries:t.data},this.state.update(!0)},build:function(){var t=this.props.db.data,e=this.state.data.topFiveQueries,n=i.e("td");n.type="dbname",n.children=[i.t(t.name)];var s=t.queries.length,f=i.e("span");f.type="label",f.children=[i.t(s)],f.classes=s>=20?a:s>=10?o:u;var c=i.e("td");c.type="query-count",c.children=[f];for(var h=[n,c],d=0;5>d;d++){var p=e[d],v=p.elapsed,g=i.t(r(v)),m=i.c(l,{query:p.query}),y=i.e("td");y.type="Query";var k=[];k.push("elapsed"),k.push(v>=10?"warn_long":v>=1?"warn":"short"),y.classes=k,y.children=[g,m],h.push(y)}var b=i.r();return b.children=h,b}});e.exports=f},{"../app":7,"./popover":11,kivi:4}],10:[function(t,e){"use strict";var r=t("kivi"),n=r.vdom,i=t("../app"),s=t("./entry"),l=["table","table-striped","latest-data"],a=n.declareComponent({tag:"table",updateState:function(){var t=i.store.getAll();this.state.sub(t),this.state.data=t.data,this.state.update(!0)},build:function(){for(var t=this.state.data,e=[],r=0;r<t.length;r++){var i=t[r];e.push(n.$c(i.data.id,s,{db:i}))}var a=n.e("tbody");a.children=e;var o=n.r();return o.classes=l,o.children=[a],o}});e.exports=a},{"../app":7,"./entry":9,kivi:4}],11:[function(t,e){"use strict";var r=t("kivi"),n=r.vdom,i=["popover","left"],s=n.declareComponent({build:function(){var t=n.e("div");t.type="popover-content",t.children=[n.t(this.props.query)];var e=n.e("div");e.type="arrow";var r=n.r();return r.classes=i,r.children=[t,e],r}});e.exports=s},{kivi:4}],12:[function(t,e){"use strict";function r(t){for(var e=[],r=0;t>r;r++)e.push(i.create({id:s++,name:"cluster"+r,queries:null})),e.push(i.create({id:s++,name:"cluster"+r+"slave",queries:null}));this._dbs=i.create(e),this.update()}var n=t("kivi"),i=n.DNode,s=0;r.prototype.getAll=function(){return this._dbs},r.prototype.get=function(t){return this._dbs.data[t]},r.prototype.update=function(){for(var t=this._dbs.data,e=0;e<t.length;e++){for(var r=t[e],n=[],i=Math.floor(10*Math.random()+1),s=0;i>s;s++){var l={elapsed:15*Math.random(),query:"SELECT blah FROM something",waiting:Math.random()<.5};Math.random()<.2&&(l.query="<IDLE> in transaction"),Math.random()<.1&&(l.query="vacuum"),n.push(l)}r.data.queries=n,r.commit()}},e.exports=r},{kivi:4}]},{},[1]);
//# sourceMappingURL=main.js.map